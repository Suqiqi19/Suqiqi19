<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>MADDPG</title>
    <url>/2023/03/13/MADDPG/</url>
    <content><![CDATA[<h1 id="MADDPG-ç®—æ³•"><a href="#MADDPG-ç®—æ³•" class="headerlink" title="MADDPG ç®—æ³•"></a>MADDPG ç®—æ³•</h1><h2 id="ç®—æ³•ä»‹ç»"><a href="#ç®—æ³•ä»‹ç»" class="headerlink" title="ç®—æ³•ä»‹ç»"></a>ç®—æ³•ä»‹ç»</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>å¤šæ™ºèƒ½ä½“ DDPGï¼ˆmuli-agent DDPGï¼ŒMADDPGï¼‰æ˜¯å°† DDPG ç®—æ³•æ‰©å±•åˆ°å¤šæ™ºèƒ½ä½“ç¯å¢ƒä¸­ï¼Œä»å­—é¢æ„æ€ä¸Šæ¥çœ‹å°±æ˜¯å¯¹äºæ¯ä¸ªæ™ºèƒ½ä½“å®ç°ä¸€ä¸ª DDPG çš„ç®—æ³•ã€‚æ‰€æœ‰æ™ºèƒ½ä½“å…±äº«ä¸€ä¸ªä¸­å¿ƒåŒ–çš„ Critic ç½‘ç»œï¼Œè¯¥ Critic ç½‘ç»œåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­åŒæ—¶å¯¹æ¯ä¸ªæ™ºèƒ½ä½“çš„ Actor ç½‘ç»œç»™å‡ºæŒ‡å¯¼ï¼Œè€Œæ‰§è¡Œæ—¶æ¯ä¸ªæ™ºèƒ½ä½“çš„ Actor ç½‘ç»œåˆ™æ˜¯å®Œå…¨ç‹¬ç«‹åšå‡ºè¡ŒåŠ¨ï¼Œå³å»ä¸­å¿ƒåŒ–åœ°æ‰§è¡Œã€‚</p>
<span id="more"></span>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>ç®—æ³•æ¨¡å‹ç”±å¤šä¸ªDDPGç½‘ç»œç»„æˆï¼Œæ¯ä¸ªç½‘ç»œå­¦ä¹ policy Ï€ (Actor) å’Œ action value Q (Critic)ï¼›åŒæ—¶å…·æœ‰target networkï¼Œç”¨äºQ-learningçš„off-policyå­¦ä¹ ã€‚ç®—æ³•æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/2023/03/13/MADDPG/æ€»è§ˆå›¾.png" alt="æ€»è§ˆå›¾"></p>
<p>æ¯ä¸ªæ™ºèƒ½ä½“ç”¨ Actor-Critic çš„æ–¹æ³•è®­ç»ƒï¼Œåœ¨ MADDPG ä¸­æ¯ä¸ªæ™ºèƒ½ä½“çš„ Critic éƒ¨åˆ†éƒ½èƒ½å¤Ÿè·å¾—å…¶ä»–æ™ºèƒ½ä½“çš„ç­–ç•¥ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œè€ƒè™‘ä¸€ä¸ªæœ‰$N$ä¸ªæ™ºèƒ½ä½“çš„åšå¼ˆï¼Œæ¯ä¸ªæ™ºèƒ½ä½“çš„ç­–ç•¥å‚æ•°ä¸º$\theta = \left \{  \theta_{1},â€¦\theta_{N}  \right \}$ ,è®°$\pi = \left \{ \pi_{1},â€¦â€¦,\pi_{N} \right \} $ ä¸ºæ‰€æœ‰æ™ºèƒ½ä½“çš„ç­–ç•¥é›†åˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†™å‡ºåœ¨éšæœºæ€§ç­–ç•¥æƒ…å†µä¸‹æ¯ä¸ªæ™ºèƒ½ä½“çš„ç´¯ç§¯æœŸæœ›å¥–åŠ±$J\left(\theta_{i}\right)=E_{s \sim \rho^{\pi}, a_{i} \sim \pi_{\theta_{i}}}\left[\sum_{t=0}^{\infty} \gamma^{t} r_{i, t}\right]$ ,é’ˆå¯¹éšæœºç­–ç•¥ï¼Œæ±‚ç­–ç•¥æ¢¯åº¦ä¸ºï¼š</p>
<script type="math/tex; mode=display">
J\left(\theta_{i}\right)=E_{s \sim \rho^{\pi}, a_{i} \sim \pi_{\theta_{i}}}\left[\sum_{t=0}^{\infty} \gamma^{t} r_{i, t}\right]\nabla_{\theta_{i}} J\left(\theta_{i}\right)=\mathbb{E}_{s \sim p^{\mu}, a \sim \pi_{i}}\left[\nabla_{\theta_{i}} \log \pi_{i}\left(a_{i} \mid o_{i}\right) Q_{i}^{\pi}\left(\mathbf{x}, a_{1}, \ldots, a_{N}\right)\right]</script><p>å…¶ä¸­ï¼Œ$Q_{i}^{\pi}\left(\mathbf{x}, a_{1}, \ldots, a_{N}\right)$å°±æ˜¯ä¸€ä¸ªä¸­å¿ƒåŒ–çš„åŠ¨ä½œä»·å€¼å‡½æ•°ã€‚ä¸ºä»€ä¹ˆè¯´$Q_{i}$æ˜¯ä¸€ä¸ªä¸­å¿ƒåŒ–çš„åŠ¨ä½œä»·å€¼å‡½æ•°å‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´$x=(o_{1},â€¦,o_{N})$åŒ…å«äº†æ‰€æœ‰æ™ºèƒ½ä½“çš„è§‚æµ‹ï¼Œå¦å¤–$Q_{i}$ä¹Ÿéœ€è¦è¾“å…¥æ‰€æœ‰æ™ºèƒ½ä½“åœ¨æ­¤åˆ»çš„åŠ¨ä½œï¼Œå› æ­¤$Q_{i}$å·¥ä½œçš„å‰æå°±æ˜¯æ‰€æœ‰æ™ºèƒ½ä½“è¦åŒæ—¶ç»™å‡ºè‡ªå·±çš„è§‚æµ‹å’Œç›¸åº”çš„åŠ¨ä½œã€‚</p>
<p>å¯¹äºç¡®å®šæ€§ç­–ç•¥æ¥è¯´ï¼Œè€ƒè™‘ç°åœ¨æœ‰Nä¸ªè¿ç»­çš„ç­–ç•¥$\mu _{\theta _{i}}$ï¼Œå¯ä»¥å¾—åˆ° DDPG çš„æ¢¯åº¦å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
\nabla_{\theta_i} J\left(\mu_i\right)=\mathbb{E}_{\mathbf{x} \sim \mathcal{D}}\left[\left.\nabla_{\theta_i} \mu_i\left(o_i\right) \nabla_{a_i} Q_i^\mu\left(\mathbf{x}, a_1, \ldots, a_N\right)\right|_{a_i=\mu_i\left(o_i\right)}\right]</script><p>å…¶ä¸­ï¼Œ$D$æ˜¯æˆ‘ä»¬ç”¨æ¥å­˜å‚¨æ•°æ®çš„ç»éªŒå›æ”¾æ± ï¼Œå®ƒå­˜å‚¨çš„æ¯ä¸€ä¸ªæ•°æ®ä¸º$\left(\mathbf{x}, \mathbf{x}^{\prime}, a_1, \ldots, a_N, r_1, \ldots, r_N\right)$ã€‚è€Œåœ¨ MADDPG ä¸­ï¼Œä¸­å¿ƒåŒ–åŠ¨ä½œä»·å€¼å‡½æ•°å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æŸå¤±å‡½æ•°æ¥æ›´æ–°ï¼š</p>
<script type="math/tex; mode=display">
\mathcal{L}\left(\omega_i\right)=\mathbb{E}_{\mathbf{x}, a, r, \mathbf{x}^{\prime}}\left[\left(Q_i^\mu\left(\mathbf{x}, a_1, \ldots, a_N\right)-y\right)^2\right], \quad y=r_i+\left.\gamma Q_i^{\mu^{\prime}}\left(\mathbf{x}^{\prime}, a_1^{\prime}, \ldots, a_N^{\prime}\right)\right|_{a_j^{\prime}=\mu_j^{\prime}\left(o_j\right)}</script><p>æµç¨‹ä¸ºï¼š</p>
<p><img src="/2023/03/13/MADDPG/ä¼ªä»£ç .png" alt="ä¼ªä»£ç "></p>
<h3 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h3><h5 id="å¯¼å…¥ä¸€äº›éœ€è¦ç”¨åˆ°çš„åŒ…ã€‚"><a href="#å¯¼å…¥ä¸€äº›éœ€è¦ç”¨åˆ°çš„åŒ…ã€‚" class="headerlink" title="å¯¼å…¥ä¸€äº›éœ€è¦ç”¨åˆ°çš„åŒ…ã€‚"></a>å¯¼å…¥ä¸€äº›éœ€è¦ç”¨åˆ°çš„åŒ…ã€‚</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> rl_utils</span><br></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºç¯å¢ƒ"><a href="#åˆ›å»ºç¯å¢ƒ" class="headerlink" title="åˆ›å»ºç¯å¢ƒ"></a>åˆ›å»ºç¯å¢ƒ</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_env</span>(<span class="params">scenario_name</span>):</span><br><span class="line">    <span class="comment"># ä»ç¯å¢ƒæ–‡ä»¶è„šæœ¬ä¸­åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">    scenario = scenarios.load(scenario_name + <span class="string">&quot;.py&quot;</span>).Scenario()</span><br><span class="line">    world = scenario.make_world()</span><br><span class="line">    env = MultiAgentEnv(world, scenario.reset_world, scenario.reward,</span><br><span class="line">                        scenario.observation)</span><br><span class="line">    <span class="keyword">return</span> env</span><br></pre></td></tr></table></figure>
<h5 id="Gumbel-Softmax-é‡‡æ ·"><a href="#Gumbel-Softmax-é‡‡æ ·" class="headerlink" title="Gumbel-Softmax é‡‡æ ·"></a>Gumbel-Softmax é‡‡æ ·</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">onehot_from_logits</span>(<span class="params">logits, eps=<span class="number">0.01</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; ç”Ÿæˆæœ€ä¼˜åŠ¨ä½œçš„ç‹¬çƒ­ï¼ˆone-hotï¼‰å½¢å¼ &#x27;&#x27;&#x27;</span></span><br><span class="line">    argmax_acs = (logits == logits.<span class="built_in">max</span>(<span class="number">1</span>, keepdim=<span class="literal">True</span>)[<span class="number">0</span>]).<span class="built_in">float</span>()</span><br><span class="line">    <span class="comment"># ç”ŸæˆéšæœºåŠ¨ä½œ,è½¬æ¢æˆç‹¬çƒ­å½¢å¼</span></span><br><span class="line">    rand_acs = torch.autograd.Variable(torch.eye(logits.shape[<span class="number">1</span>])[[</span><br><span class="line">        np.random.choice(<span class="built_in">range</span>(logits.shape[<span class="number">1</span>]), size=logits.shape[<span class="number">0</span>])</span><br><span class="line">    ]],</span><br><span class="line">                                       requires_grad=<span class="literal">False</span>).to(logits.device)</span><br><span class="line">    <span class="comment"># é€šè¿‡epsilon-è´ªå©ªç®—æ³•æ¥é€‰æ‹©ç”¨å“ªä¸ªåŠ¨ä½œ</span></span><br><span class="line">    <span class="keyword">return</span> torch.stack([</span><br><span class="line">        argmax_acs[i] <span class="keyword">if</span> r &gt; eps <span class="keyword">else</span> rand_acs[i]</span><br><span class="line">        <span class="keyword">for</span> i, r <span class="keyword">in</span> <span class="built_in">enumerate</span>(torch.rand(logits.shape[<span class="number">0</span>]))</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_gumbel</span>(<span class="params">shape, eps=<span class="number">1e-20</span>, tens_type=torch.FloatTensor</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»Gumbel(0,1)åˆ†å¸ƒä¸­é‡‡æ ·&quot;&quot;&quot;</span></span><br><span class="line">    U = torch.autograd.Variable(tens_type(*shape).uniform_(),</span><br><span class="line">                                requires_grad=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> -torch.log(-torch.log(U + eps) + eps)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gumbel_softmax_sample</span>(<span class="params">logits, temperature</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; ä»Gumbel-Softmaxåˆ†å¸ƒä¸­é‡‡æ ·&quot;&quot;&quot;</span></span><br><span class="line">    y = logits + sample_gumbel(logits.shape, tens_type=<span class="built_in">type</span>(logits.data)).to(</span><br><span class="line">        logits.device)</span><br><span class="line">    <span class="keyword">return</span> F.softmax(y / temperature, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gumbel_softmax</span>(<span class="params">logits, temperature=<span class="number">1.0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»Gumbel-Softmaxåˆ†å¸ƒä¸­é‡‡æ ·,å¹¶è¿›è¡Œç¦»æ•£åŒ–&quot;&quot;&quot;</span></span><br><span class="line">    y = gumbel_softmax_sample(logits, temperature)</span><br><span class="line">    y_hard = onehot_from_logits(y)</span><br><span class="line">    y = (y_hard.to(logits.device) - y).detach() + y</span><br><span class="line">    <span class="comment"># è¿”å›ä¸€ä¸ªy_hardçš„ç‹¬çƒ­é‡,ä½†æ˜¯å®ƒçš„æ¢¯åº¦æ˜¯y,æˆ‘ä»¬æ—¢èƒ½å¤Ÿå¾—åˆ°ä¸€ä¸ªä¸ç¯å¢ƒäº¤äº’çš„ç¦»æ•£åŠ¨ä½œ,åˆå¯ä»¥</span></span><br><span class="line">    <span class="comment"># æ­£ç¡®åœ°åä¼ æ¢¯åº¦</span></span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure>
<h5 id="å•æ™ºèƒ½ä½“-DDPG"><a href="#å•æ™ºèƒ½ä½“-DDPG" class="headerlink" title="å•æ™ºèƒ½ä½“ DDPG"></a>å•æ™ºèƒ½ä½“ DDPG</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TwoLayerFC</span>(torch.nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num_in, num_out, hidden_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.fc1 = torch.nn.Linear(num_in, hidden_dim)</span><br><span class="line">        self.fc2 = torch.nn.Linear(hidden_dim, hidden_dim)</span><br><span class="line">        self.fc3 = torch.nn.Linear(hidden_dim, num_out)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = F.relu(self.fc1(x))</span><br><span class="line">        x = F.relu(self.fc2(x))</span><br><span class="line">        <span class="keyword">return</span> self.fc3(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DDPG</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; DDPGç®—æ³• &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, state_dim, action_dim, critic_input_dim, hidden_dim,</span></span><br><span class="line"><span class="params">                 actor_lr, critic_lr, device</span>):</span><br><span class="line">        self.actor = TwoLayerFC(state_dim, action_dim, hidden_dim).to(device)</span><br><span class="line">        self.target_actor = TwoLayerFC(state_dim, action_dim,</span><br><span class="line">                                       hidden_dim).to(device)</span><br><span class="line">        self.critic = TwoLayerFC(critic_input_dim, <span class="number">1</span>, hidden_dim).to(device)</span><br><span class="line">        self.target_critic = TwoLayerFC(critic_input_dim, <span class="number">1</span>,</span><br><span class="line">                                        hidden_dim).to(device)</span><br><span class="line">        self.target_critic.load_state_dict(self.critic.state_dict())</span><br><span class="line">        self.target_actor.load_state_dict(self.actor.state_dict())</span><br><span class="line">        self.actor_optimizer = torch.optim.Adam(self.actor.parameters(),</span><br><span class="line">                                                lr=actor_lr)</span><br><span class="line">        self.critic_optimizer = torch.optim.Adam(self.critic.parameters(),</span><br><span class="line">                                                 lr=critic_lr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">take_action</span>(<span class="params">self, state, explore=<span class="literal">False</span></span>):</span><br><span class="line">        action = self.actor(state)</span><br><span class="line">        <span class="keyword">if</span> explore:</span><br><span class="line">            action = gumbel_softmax(action)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            action = onehot_from_logits(action)</span><br><span class="line">        <span class="keyword">return</span> action.detach().cpu().numpy()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">soft_update</span>(<span class="params">self, net, target_net, tau</span>):</span><br><span class="line">        <span class="keyword">for</span> param_target, param <span class="keyword">in</span> <span class="built_in">zip</span>(target_net.parameters(),</span><br><span class="line">                                       net.parameters()):</span><br><span class="line">            param_target.data.copy_(param_target.data * (<span class="number">1.0</span> - tau) +</span><br><span class="line">                                    param.data * tau)</span><br></pre></td></tr></table></figure>
<h5 id="MADDPG-ç±»"><a href="#MADDPG-ç±»" class="headerlink" title="MADDPG ç±»"></a>MADDPG ç±»</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MADDPG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, env, device, actor_lr, critic_lr, hidden_dim,</span></span><br><span class="line"><span class="params">                 state_dims, action_dims, critic_input_dim, gamma, tau</span>):</span><br><span class="line">        self.agents = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(env.agents)):</span><br><span class="line">            self.agents.append(</span><br><span class="line">                DDPG(state_dims[i], action_dims[i], critic_input_dim,</span><br><span class="line">                     hidden_dim, actor_lr, critic_lr, device))</span><br><span class="line">        self.gamma = gamma</span><br><span class="line">        self.tau = tau</span><br><span class="line">        self.critic_criterion = torch.nn.MSELoss()</span><br><span class="line">        self.device = device</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">policies</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> [agt.actor <span class="keyword">for</span> agt <span class="keyword">in</span> self.agents]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">target_policies</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> [agt.target_actor <span class="keyword">for</span> agt <span class="keyword">in</span> self.agents]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">take_action</span>(<span class="params">self, states, explore</span>):</span><br><span class="line">        states = [</span><br><span class="line">            torch.tensor([states[i]], dtype=torch.<span class="built_in">float</span>, device=self.device)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(env.agents))</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            agent.take_action(state, explore)</span><br><span class="line">            <span class="keyword">for</span> agent, state <span class="keyword">in</span> <span class="built_in">zip</span>(self.agents, states)</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, sample, i_agent</span>):</span><br><span class="line">        obs, act, rew, next_obs, done = sample</span><br><span class="line">        cur_agent = self.agents[i_agent]</span><br><span class="line"></span><br><span class="line">        cur_agent.critic_optimizer.zero_grad()</span><br><span class="line">        all_target_act = [</span><br><span class="line">            onehot_from_logits(pi(_next_obs))</span><br><span class="line">            <span class="keyword">for</span> pi, _next_obs <span class="keyword">in</span> <span class="built_in">zip</span>(self.target_policies, next_obs)</span><br><span class="line">        ]</span><br><span class="line">        target_critic_input = torch.cat((*next_obs, *all_target_act), dim=<span class="number">1</span>)</span><br><span class="line">        target_critic_value = rew[i_agent].view(</span><br><span class="line">            -<span class="number">1</span>, <span class="number">1</span>) + self.gamma * cur_agent.target_critic(</span><br><span class="line">                target_critic_input) * (<span class="number">1</span> - done[i_agent].view(-<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">        critic_input = torch.cat((*obs, *act), dim=<span class="number">1</span>)</span><br><span class="line">        critic_value = cur_agent.critic(critic_input)</span><br><span class="line">        critic_loss = self.critic_criterion(critic_value,</span><br><span class="line">                                            target_critic_value.detach())</span><br><span class="line">        critic_loss.backward()</span><br><span class="line">        cur_agent.critic_optimizer.step()</span><br><span class="line"></span><br><span class="line">        cur_agent.actor_optimizer.zero_grad()</span><br><span class="line">        cur_actor_out = cur_agent.actor(obs[i_agent])</span><br><span class="line">        cur_act_vf_in = gumbel_softmax(cur_actor_out)</span><br><span class="line">        all_actor_acs = []</span><br><span class="line">        <span class="keyword">for</span> i, (pi, _obs) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(self.policies, obs)):</span><br><span class="line">            <span class="keyword">if</span> i == i_agent:</span><br><span class="line">                all_actor_acs.append(cur_act_vf_in)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                all_actor_acs.append(onehot_from_logits(pi(_obs)))</span><br><span class="line">        vf_in = torch.cat((*obs, *all_actor_acs), dim=<span class="number">1</span>)</span><br><span class="line">        actor_loss = -cur_agent.critic(vf_in).mean()</span><br><span class="line">        actor_loss += (cur_actor_out**<span class="number">2</span>).mean() * <span class="number">1e-3</span></span><br><span class="line">        actor_loss.backward()</span><br><span class="line">        cur_agent.actor_optimizer.step()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_all_targets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> agt <span class="keyword">in</span> self.agents:</span><br><span class="line">            agt.soft_update(agt.actor, agt.target_actor, self.tau)</span><br><span class="line">            agt.soft_update(agt.critic, agt.target_critic, self.tau)</span><br></pre></td></tr></table></figure>
<h5 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">num_episodes = <span class="number">5000</span></span><br><span class="line">episode_length = <span class="number">25</span>  <span class="comment"># æ¯æ¡åºåˆ—çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line">buffer_size = <span class="number">100000</span></span><br><span class="line">hidden_dim = <span class="number">64</span></span><br><span class="line">actor_lr = <span class="number">1e-2</span></span><br><span class="line">critic_lr = <span class="number">1e-2</span></span><br><span class="line">gamma = <span class="number">0.95</span></span><br><span class="line">tau = <span class="number">1e-2</span></span><br><span class="line">batch_size = <span class="number">1024</span></span><br><span class="line">device = torch.device(<span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">update_interval = <span class="number">100</span></span><br><span class="line">minimal_size = <span class="number">4000</span></span><br><span class="line"></span><br><span class="line">env_id = <span class="string">&quot;simple_adversary&quot;</span></span><br><span class="line">env = make_env(env_id)</span><br><span class="line">replay_buffer = rl_utils.ReplayBuffer(buffer_size)</span><br><span class="line"></span><br><span class="line">state_dims = []</span><br><span class="line">action_dims = []</span><br><span class="line"><span class="keyword">for</span> action_space <span class="keyword">in</span> env.action_space:</span><br><span class="line">    action_dims.append(action_space.n)</span><br><span class="line"><span class="keyword">for</span> state_space <span class="keyword">in</span> env.observation_space:</span><br><span class="line">    state_dims.append(state_space.shape[<span class="number">0</span>])</span><br><span class="line">critic_input_dim = <span class="built_in">sum</span>(state_dims) + <span class="built_in">sum</span>(action_dims)</span><br><span class="line"></span><br><span class="line">maddpg = MADDPG(env, device, actor_lr, critic_lr, hidden_dim, state_dims,</span><br><span class="line">                action_dims, critic_input_dim, gamma, tau)</span><br></pre></td></tr></table></figure>
<h5 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate</span>(<span class="params">env_id, maddpg, n_episode=<span class="number">10</span>, episode_length=<span class="number">25</span></span>):</span><br><span class="line">    <span class="comment"># å¯¹å­¦ä¹ çš„ç­–ç•¥è¿›è¡Œè¯„ä¼°,æ­¤æ—¶ä¸ä¼šè¿›è¡Œæ¢ç´¢</span></span><br><span class="line">    env = make_env(env_id)</span><br><span class="line">    returns = np.zeros(<span class="built_in">len</span>(env.agents))</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n_episode):</span><br><span class="line">        obs = env.reset()</span><br><span class="line">        <span class="keyword">for</span> t_i <span class="keyword">in</span> <span class="built_in">range</span>(episode_length):</span><br><span class="line">            actions = maddpg.take_action(obs, explore=<span class="literal">False</span>)</span><br><span class="line">            obs, rew, done, info = env.step(actions)</span><br><span class="line">            rew = np.array(rew)</span><br><span class="line">            returns += rew / n_episode</span><br><span class="line">    <span class="keyword">return</span> returns.tolist()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">return_list = []  <span class="comment"># è®°å½•æ¯ä¸€è½®çš„å›æŠ¥ï¼ˆreturnï¼‰</span></span><br><span class="line">total_step = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i_episode <span class="keyword">in</span> <span class="built_in">range</span>(num_episodes):</span><br><span class="line">    state = env.reset()</span><br><span class="line">    <span class="comment"># ep_returns = np.zeros(len(env.agents))</span></span><br><span class="line">    <span class="keyword">for</span> e_i <span class="keyword">in</span> <span class="built_in">range</span>(episode_length):</span><br><span class="line">        actions = maddpg.take_action(state, explore=<span class="literal">True</span>)</span><br><span class="line">        next_state, reward, done, _ = env.step(actions)</span><br><span class="line">        replay_buffer.add(state, actions, reward, next_state, done)</span><br><span class="line">        state = next_state</span><br><span class="line"></span><br><span class="line">        total_step += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> replay_buffer.size(</span><br><span class="line">        ) &gt;= minimal_size <span class="keyword">and</span> total_step % update_interval == <span class="number">0</span>:</span><br><span class="line">            sample = replay_buffer.sample(batch_size)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">stack_array</span>(<span class="params">x</span>):</span><br><span class="line">                rearranged = [[sub_x[i] <span class="keyword">for</span> sub_x <span class="keyword">in</span> x]</span><br><span class="line">                              <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x[<span class="number">0</span>]))]</span><br><span class="line">                <span class="keyword">return</span> [</span><br><span class="line">                    torch.FloatTensor(np.vstack(aa)).to(device)</span><br><span class="line">                    <span class="keyword">for</span> aa <span class="keyword">in</span> rearranged</span><br><span class="line">                ]</span><br><span class="line"></span><br><span class="line">            sample = [stack_array(x) <span class="keyword">for</span> x <span class="keyword">in</span> sample]</span><br><span class="line">            <span class="keyword">for</span> a_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(env.agents)):</span><br><span class="line">                maddpg.update(sample, a_i)</span><br><span class="line">            maddpg.update_all_targets()</span><br><span class="line">    <span class="keyword">if</span> (i_episode + <span class="number">1</span>) % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">        ep_returns = evaluate(env_id, maddpg, n_episode=<span class="number">100</span>)</span><br><span class="line">        return_list.append(ep_returns)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Episode: <span class="subst">&#123;i_episode+<span class="number">1</span>&#125;</span>, <span class="subst">&#123;ep_returns&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">return_array = np.array(return_list)</span><br><span class="line"><span class="keyword">for</span> i, agent_name <span class="keyword">in</span> <span class="built_in">enumerate</span>([<span class="string">&quot;adversary_0&quot;</span>, <span class="string">&quot;agent_0&quot;</span>, <span class="string">&quot;agent_1&quot;</span>]):</span><br><span class="line">    plt.figure()</span><br><span class="line">    plt.plot(</span><br><span class="line">        np.arange(return_array.shape[<span class="number">0</span>]) * <span class="number">100</span>,</span><br><span class="line">        rl_utils.moving_average(return_array[:, i], <span class="number">9</span>))</span><br><span class="line">    plt.xlabel(<span class="string">&quot;Episodes&quot;</span>)</span><br><span class="line">    plt.ylabel(<span class="string">&quot;Returns&quot;</span>)</span><br><span class="line">    plt.title(<span class="string">f&quot;<span class="subst">&#123;agent_name&#125;</span> by MADDPG&quot;</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>MARL</category>
      </categories>
      <tags>
        <tag>å¤šæ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>æ¢ç´¢ä¸åˆ©ç”¨</title>
    <url>/2023/03/13/%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="æ¢ç´¢ä¸åˆ©ç”¨"><a href="#æ¢ç´¢ä¸åˆ©ç”¨" class="headerlink" title="æ¢ç´¢ä¸åˆ©ç”¨"></a>æ¢ç´¢ä¸åˆ©ç”¨</h1><h3 id="åºåˆ—å†³ç­–ä»»åŠ¡ä¸­çš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜"><a href="#åºåˆ—å†³ç­–ä»»åŠ¡ä¸­çš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜" class="headerlink" title="åºåˆ—å†³ç­–ä»»åŠ¡ä¸­çš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜"></a>åºåˆ—å†³ç­–ä»»åŠ¡ä¸­çš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜</h3><ul>
<li>Exploitation: æ‰§è¡Œèƒ½å¤Ÿè·å¾—å·²çŸ¥æœ€ä¼˜æ”¶ç›Šçš„å†³ç­–</li>
<li>Exploration: å°è¯•æ›´å¤šå¯èƒ½çš„å†³ç­–ï¼Œä½†ä¸ä¸€å®šæ˜¯æœ€ä¼˜æ”¶ç›Š</li>
</ul>
<span id="more"></span>
<h3 id="ç­–ç•¥æ¢ç´¢çš„ä¸€äº›åŸåˆ™"><a href="#ç­–ç•¥æ¢ç´¢çš„ä¸€äº›åŸåˆ™" class="headerlink" title="ç­–ç•¥æ¢ç´¢çš„ä¸€äº›åŸåˆ™"></a>ç­–ç•¥æ¢ç´¢çš„ä¸€äº›åŸåˆ™</h3><ul>
<li>æœ´ç´ æ–¹æ³•ï¼ˆNaive Exploration)</li>
</ul>
<ul>
<li>æ·»åŠ ç­–ç•¥å™ªå£° e-greddy</li>
</ul>
<ul>
<li>ç§¯æåˆå§‹åŒ–ï¼ˆOptimistic initialization)</li>
</ul>
<ul>
<li><p>åŸºäºä¸ç¡®å®šæ€§çš„åº¦é‡(Uncertainty Measurement)</p>
<ul>
<li>â€‹    ä¸ç¡®å®šæ€§è¶Šå¤§ï¼Œè¶Šæœ‰æ¢ç´¢ä»·å€¼</li>
</ul>
</li>
</ul>
<pre><code>- â€‹    ä¸Šç½®ä¿¡ç•Œ
</code></pre><p>â€‹    <img src="/2023/03/13/%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%88%A9%E7%94%A8/ä¸Šç½®ä¿¡.png" alt="ä¸Šç½®ä¿¡"></p>
<ul>
<li>æ¦‚ç‡åŒ¹é…(Probability Matching)</li>
</ul>
<h3 id="å¤šåŠ¨è‡‚è€è™æœº"><a href="#å¤šåŠ¨è‡‚è€è™æœº" class="headerlink" title="å¤šåŠ¨è‡‚è€è™æœº"></a>å¤šåŠ¨è‡‚è€è™æœº</h3><h4 id="å‡ ä¸ªç‚¹"><a href="#å‡ ä¸ªç‚¹" class="headerlink" title="å‡ ä¸ªç‚¹:"></a>å‡ ä¸ªç‚¹:</h4><p>æœŸæœ›æ”¶ç›Šé‡‡ç”¨å¢é‡å¼æ›´æ–°ï¼Œæ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦éƒ½å‡å°ã€‚</p>
<p>æ‡Šæ‚”å€¼ï¼š$ R(a^i)=Q^\star-Q(a^i) $</p>
<p>æ€»æ‡Šæ‚”å€¼  ï¼š$\sum_{t=1}^{T}R(a_{t})$</p>
<p>æœ€å°åŒ–æ‡Šæ‚”å€¼ ç­‰ä»·äº æœ€å¤§åŒ–æœŸæœ›æ”¶ç›Š</p>
<p>$\sigma_{R}$æœ‰ä¸‹ç•Œ</p>
<h4 id="è´ªå¿ƒç­–ç•¥å’Œ-varepsilon-greddy-è´ªå¿ƒç®—æ³•"><a href="#è´ªå¿ƒç­–ç•¥å’Œ-varepsilon-greddy-è´ªå¿ƒç®—æ³•" class="headerlink" title="è´ªå¿ƒç­–ç•¥å’Œ$ \varepsilon -greddy$è´ªå¿ƒç®—æ³•"></a>è´ªå¿ƒç­–ç•¥å’Œ$ \varepsilon -greddy$è´ªå¿ƒç®—æ³•</h4><p><img src="/2023/03/13/%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%88%A9%E7%94%A8/æ¢ç´¢ç­–ç•¥.png" alt="æ¢ç´¢ç­–ç•¥"></p>
<p>â€‹    </p>
<p>è¡°å‡è´ªå¿ƒç­–ç•¥ $\varepsilon$è¡°å‡</p>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://hrl.boyuai.com/chapter/1">https://hrl.boyuai.com/chapter/1</a></p>
]]></content>
      <categories>
        <category>RL</category>
      </categories>
      <tags>
        <tag>å¼ºåŒ–å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>å¼ºåŒ–å­¦ä¹ æ¦‚å¿µ</title>
    <url>/2023/03/12/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%A6%82%E5%BF%B5/</url>
    <content><![CDATA[<h2 id="å¼ºåŒ–å­¦ä¹ åŸºæœ¬æ¦‚å¿µ"><a href="#å¼ºåŒ–å­¦ä¹ åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="å¼ºåŒ–å­¦ä¹ åŸºæœ¬æ¦‚å¿µ"></a>å¼ºåŒ–å­¦ä¹ åŸºæœ¬æ¦‚å¿µ</h2><h3 id="æœºå™¨å­¦ä¹ åˆ†ç±»"><a href="#æœºå™¨å­¦ä¹ åˆ†ç±»" class="headerlink" title="æœºå™¨å­¦ä¹ åˆ†ç±»"></a>æœºå™¨å­¦ä¹ åˆ†ç±»</h3><h4 id="é¢„æµ‹"><a href="#é¢„æµ‹" class="headerlink" title="é¢„æµ‹"></a>é¢„æµ‹</h4><ul>
<li><p>æœ‰ç›‘ç£</p>
</li>
<li><p>æ— ç›‘ç£</p>
</li>
</ul>
<h4 id="å†³ç­–"><a href="#å†³ç­–" class="headerlink" title="å†³ç­–"></a>å†³ç­–</h4><ul>
<li>å¼ºåŒ–å­¦ä¹ </li>
</ul>
<span id="more"></span>
<h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>é€šè¿‡ä»äº¤äº’ä¸­å­¦ä¹ æ¥å®ç°ç›®æ ‡çš„è®¡ç®—æ–¹æ³•ã€‚</p>
<p><strong>ä¸‰ä¸ªæ–¹é¢ï¼š</strong></p>
<ul>
<li>æ„ŸçŸ¥ï¼šåœ¨æŸç§ç¨‹åº¦ä¸Šæ„ŸçŸ¥ç¯å¢ƒçš„çŠ¶æ€ â€¢ </li>
<li>è¡ŒåŠ¨ï¼šå¯ä»¥é‡‡å–è¡ŒåŠ¨æ¥å½±å“çŠ¶æ€æˆ–è€…è¾¾åˆ°ç›®æ ‡ </li>
<li>ç›®æ ‡ï¼šéšç€æ—¶é—´æ¨ç§»æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±</li>
</ul>
<h3 id="äº¤äº’è¿‡ç¨‹"><a href="#äº¤äº’è¿‡ç¨‹" class="headerlink" title="äº¤äº’è¿‡ç¨‹"></a>äº¤äº’è¿‡ç¨‹</h3><p><img src="/2023/03/12/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%A6%82%E5%BF%B5/äº¤äº’è¿‡ç¨‹.png" alt="äº¤äº’è¿‡ç¨‹"></p>
<h3 id="è¦ç´ "><a href="#è¦ç´ " class="headerlink" title="è¦ç´ "></a>è¦ç´ </h3><ol>
<li><p>æ™ºèƒ½ä½“ agent</p>
<p>èƒ½å¤Ÿtakeä¸€ä¸ªactionï¼Œdeliveråˆ°ç¯å¢ƒenvä¸­ï¼Œè·å¾—reward/</p>
</li>
<li><p>å†å²ï¼ˆHistoryï¼‰æ˜¯è§‚å¯Ÿã€è¡ŒåŠ¨å’Œå¥–åŠ±çš„åºåˆ—ã€‚</p>
<p>ğ»ğ‘¡ = ğ‘‚1, ğ‘…1, ğ´1,ğ‘‚2, ğ‘…2, ğ´2, â€¦ , ğ‘‚ğ‘¡âˆ’1, ğ‘…ğ‘¡âˆ’1, ğ´ğ‘¡âˆ’1,ğ‘‚ğ‘¡ , ğ‘…</p>
</li>
<li><p>çŠ¶æ€ï¼ˆstateï¼‰æ˜¯ä¸€ç§ç”¨äºç¡®å®šæ¥ä¸‹æ¥ä¼šå‘ç”Ÿçš„äº‹æƒ…ï¼ˆè¡ŒåŠ¨ã€è§‚å¯Ÿã€ å¥–åŠ±ï¼‰çš„ä¿¡æ¯</p>
</li>
<li><p>çŠ¶æ€æ˜¯å…³äºå†å²çš„å‡½æ•° ğ‘†ğ‘¡ = ğ‘“(ğ»ğ‘¡)</p>
</li>
<li><p>ç­–ç•¥ï¼ˆPolicyï¼‰æ˜¯å­¦ä¹ æ™ºèƒ½ä½“åœ¨ç‰¹å®šæ—¶é—´çš„è¡Œä¸ºæ–¹å¼</p>
<ul>
<li><p>æ˜¯ä»çŠ¶æ€åˆ°è¡ŒåŠ¨çš„æ˜ å°„ </p>
</li>
<li><p>ç¡®å®šæ€§ç­–ç•¥ï¼ˆDeterministic Policyï¼‰  ğ‘ = ğœ‹(ğ‘ ) ï¼ˆæ˜¯ä¸€ä¸ªå‡½æ•°ï¼‰</p>
</li>
<li><p>éšæœºç­–ç•¥ï¼ˆStochastic Policyï¼‰ğœ‹ï¼ˆ ğ‘| ğ‘ ï¼‰ = ğ‘ƒ ï¼ˆğ´ğ‘¡ = ğ‘ |ğ‘†ğ‘¡ = ğ‘ )ï¼ˆæ˜¯ä¸€ä¸ªåˆ†å¸ƒï¼‰</p>
</li>
</ul>
</li>
<li><p>å¥–åŠ±ï¼ˆRewardï¼‰</p>
<ul>
<li><p>ä¸€ä¸ªå®šä¹‰å¼ºåŒ–å­¦ä¹ ç›®æ ‡çš„æ ‡é‡ </p>
</li>
<li><p>èƒ½ç«‹å³æ„ŸçŸ¥åˆ°ä»€ä¹ˆæ˜¯â€œå¥½â€çš„</p>
</li>
</ul>
</li>
<li><p>ä»·å€¼å‡½æ•°ï¼ˆValue Functionï¼‰</p>
<ul>
<li><p>çŠ¶æ€ä»·å€¼æ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œç”¨äºå®šä¹‰å¯¹äºé•¿æœŸæ¥è¯´ä»€ä¹ˆæ˜¯ â€œå¥½â€çš„</p>
</li>
<li><p>ä»·å€¼å‡½æ•°æ˜¯å¯¹äºæœªæ¥ç´¯ç§¯å¥–åŠ±çš„é¢„æµ‹</p>
</li>
<li><p>ç”¨äºè¯„ä¼°åœ¨ç»™å®šçš„ç­–ç•¥ä¸‹ï¼ŒçŠ¶æ€çš„å¥½å</p>
</li>
<li><script type="math/tex; mode=display">
\begin{aligned}
Q_{\pi}(s, a) & =\mathbb{E}_{\pi}\left[R_{t+1}+\gamma R_{t+2}+\gamma^{2} R_{t+3}+\cdots \mid S_{t}=s, A_{t}=a\right] \\
& =\mathbb{E}_{\pi}\left[R_{t+1}+\gamma Q_{\pi}\left(s^{\prime}, a^{\prime}\right) \mid S_{t}=s, A_{t}=a\right]
\end{aligned}</script></li>
</ul>
</li>
</ol>
<ol>
<li><p>ç¯å¢ƒçš„æ¨¡å‹ï¼ˆModelï¼‰ç”¨äºæ¨¡ æ‹Ÿç¯å¢ƒçš„è¡Œä¸º</p>
<ul>
<li>é¢„æµ‹ä¸‹ä¸€ä¸ªçŠ¶æ€<script type="math/tex; mode=display">
\begin{aligned}
Q_{\pi}(s, a) & =\mathbb{E}_{\pi}\left[R_{t+1}+\gamma R_{t+2}+\gamma^{2} R_{t+3}+\cdots \mid S_{t}=s, A_{t}=a\right] \\
& =\mathbb{E}_{\pi}\left[R_{t+1}+\gamma Q_{\pi}\left(s^{\prime}, a^{\prime}\right) \mid S_{t}=s, A_{t}=a\right]
\end{aligned}\mathcal{P}_{s S^{\prime}}^{a}=\mathbb{P}\left[S_{t+1}=s^{\prime} \mid S_{t}=s, A_{t}=a\right]</script></li>
</ul>
</li>
</ol>
<ul>
<li>é¢„æµ‹ä¸‹ä¸€ä¸ªï¼ˆç«‹å³ï¼‰å¥–åŠ±</li>
</ul>
<h3 id="å¼ºåŒ–å­¦ä¹ åˆ†ç±»"><a href="#å¼ºåŒ–å­¦ä¹ åˆ†ç±»" class="headerlink" title="å¼ºåŒ–å­¦ä¹ åˆ†ç±»"></a>å¼ºåŒ–å­¦ä¹ åˆ†ç±»</h3><p>åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ </p>
<p>æ¨¡å‹æ— å…³çš„å¼ºåŒ–å­¦ä¹ </p>
<ol>
<li><p>åŸºäºä»·å€¼ï¼šçŸ¥é“ä»€ä¹ˆæ˜¯å¥½çš„ä»€ä¹ˆæ˜¯åçš„</p>
<ul>
<li><p>æ²¡æœ‰ç­–ç•¥ï¼ˆéšå«ï¼‰    </p>
</li>
<li><p>ä»·å€¼å‡½æ•°</p>
<script type="math/tex; mode=display">
\nabla_{\theta_{i}} L_{i}\left(\theta_{i}\right)=\mathbb{E}_{s, a \sim \rho(\cdot) ; s^{\prime} \sim \mathcal{E}}\left[\left(r+\gamma \max _{a^{\prime}} Q\left(s^{\prime}, a^{\prime} ; \theta_{i-1}\right)-Q\left(s, a ; \theta_{i}\right)\right) \nabla_{\theta_{i}} Q\left(s, a ; \theta_{i}\right)\right]</script></li>
</ul>
</li>
</ol>
<ol>
<li><p>åŸºäºç­–ç•¥ï¼šçŸ¥é“æ€ä¹ˆè¡ŒåŠ¨</p>
<ul>
<li><p>ç­–ç•¥</p>
</li>
<li><p>æ²¡æœ‰ä»·å€¼å‡½æ•°</p>
</li>
</ul>
</li>
<li><p>Actor-Criticï¼šå­¦ç”Ÿå¬è€å¸ˆçš„</p>
<ul>
<li><p>ç­–ç•¥</p>
</li>
<li><p>ä»·å€¼å‡½æ•°</p>
</li>
</ul>
</li>
</ol>
<p>â€‹                </p>
]]></content>
      <categories>
        <category>RL</category>
      </categories>
      <tags>
        <tag>å¼ºåŒ–å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>æ•ˆç”¨ç†è®º</title>
    <url>/2023/03/10/%E6%95%88%E7%94%A8%E7%90%86%E8%AE%BA/</url>
    <content><![CDATA[<h2 id="æ•ˆç”¨ç†è®º"><a href="#æ•ˆç”¨ç†è®º" class="headerlink" title="æ•ˆç”¨ç†è®º"></a>æ•ˆç”¨ç†è®º</h2><h3 id="ç†è§£æ•ˆç”¨çš„æ¦‚å¿µ"><a href="#ç†è§£æ•ˆç”¨çš„æ¦‚å¿µ" class="headerlink" title="ç†è§£æ•ˆç”¨çš„æ¦‚å¿µ"></a>ç†è§£æ•ˆç”¨çš„æ¦‚å¿µ</h3><p>æ•ˆç”¨å°±æ˜¯åå¥½çš„é‡åŒ–ï¼Œæ˜¯æ•°(å®å€¼å‡½æ•°)ï¼Œåæ˜ ç»“æœå€¼å¯¹å†³ç­–è€…ä»·å€¼å’Œä½œç”¨å¤§å°çš„é‡å€¼ ç§°ä¸ºæ•ˆç”¨ã€‚</p>
<span id="more"></span>
<h3 id="æŒæ¡æ•ˆç”¨ï¼Œæ•ˆç”¨å‡½æ•°çš„å®šä¹‰"><a href="#æŒæ¡æ•ˆç”¨ï¼Œæ•ˆç”¨å‡½æ•°çš„å®šä¹‰" class="headerlink" title="æŒæ¡æ•ˆç”¨ï¼Œæ•ˆç”¨å‡½æ•°çš„å®šä¹‰"></a>æŒæ¡æ•ˆç”¨ï¼Œæ•ˆç”¨å‡½æ•°çš„å®šä¹‰</h3><p>åœ¨é›†åˆ T ä¸Šçš„å®å€¼å‡½æ•° uï¼Œè‹¥å®ƒå’Œ T ä¸Šçš„ä¼˜å…ˆå…³ç³»â€œâ‰½ â€ä¸€è‡´ï¼Œå³ï¼šè‹¥ T , T 1âˆˆ Tï¼Œ T2 â‰½T å½“ä¸”ä»…å½“ u(T1 ) â‰¥ u(T2),åˆ™ç§° u ä¸ºæ•ˆç”¨å‡½æ•°ã€‚</p>
<p>ï¼ˆæ–‡å­—è¡¨è¿°ï¼‰:è®¾å†³ç­–é—®é¢˜çš„å„å¯è¡Œæ–¹æ¡ˆæœ‰å¤šç§å¯èƒ½çš„ç»“æœå€¼ oï¼Œä¾æ®å†³ç­–è€…çš„ä¸» è§‚æ„¿æœ›å’Œä»·å€¼å€¾å‘ï¼Œæ¯ä¸ªç»“æœå€¼å¯¹å†³ç­–è€…æœ‰ä¸åŒçš„ä»·å€¼å’Œä½œç”¨ã€‚åæ˜ ç»“æœå€¼ o å¯¹å†³ç­–è€…ä»·å€¼ å’Œä½œç”¨å¤§å°çš„é‡å€¼ç§°ä¸ºæ•ˆç”¨ï¼Œè®°ä½œï¼šu=u(o)</p>
<h3 id="æ•ˆç”¨ç¡®å®šçš„æ–¹æ³•"><a href="#æ•ˆç”¨ç¡®å®šçš„æ–¹æ³•" class="headerlink" title="æ•ˆç”¨ç¡®å®šçš„æ–¹æ³•"></a>æ•ˆç”¨ç¡®å®šçš„æ–¹æ³•</h3><h3 id="æ•ˆç”¨æœ‰ç•Œæ€§å’Œå­˜åœ¨æ€§è¯æ˜"><a href="#æ•ˆç”¨æœ‰ç•Œæ€§å’Œå­˜åœ¨æ€§è¯æ˜" class="headerlink" title="æ•ˆç”¨æœ‰ç•Œæ€§å’Œå­˜åœ¨æ€§è¯æ˜"></a>æ•ˆç”¨æœ‰ç•Œæ€§å’Œå­˜åœ¨æ€§è¯æ˜</h3><h3 id="æ•ˆç”¨å‡½æ•°çš„æ„é€ æ–¹æ³•"><a href="#æ•ˆç”¨å‡½æ•°çš„æ„é€ æ–¹æ³•" class="headerlink" title="æ•ˆç”¨å‡½æ•°çš„æ„é€ æ–¹æ³•"></a>æ•ˆç”¨å‡½æ•°çš„æ„é€ æ–¹æ³•</h3><h3 id="ç†Ÿæ‚‰åŸºæ•°æ•ˆç”¨å’Œåºæ•°æ•ˆç”¨"><a href="#ç†Ÿæ‚‰åŸºæ•°æ•ˆç”¨å’Œåºæ•°æ•ˆç”¨" class="headerlink" title="ç†Ÿæ‚‰åŸºæ•°æ•ˆç”¨å’Œåºæ•°æ•ˆç”¨"></a>ç†Ÿæ‚‰åŸºæ•°æ•ˆç”¨å’Œåºæ•°æ•ˆç”¨</h3><h3 id="é£é™©æ€åº¦ä¸æ•ˆç”¨å…³ç³»"><a href="#é£é™©æ€åº¦ä¸æ•ˆç”¨å…³ç³»" class="headerlink" title="é£é™©æ€åº¦ä¸æ•ˆç”¨å…³ç³»"></a>é£é™©æ€åº¦ä¸æ•ˆç”¨å…³ç³»</h3><h3 id="è´§å¸çš„æ•ˆç”¨"><a href="#è´§å¸çš„æ•ˆç”¨" class="headerlink" title="è´§å¸çš„æ•ˆç”¨"></a>è´§å¸çš„æ•ˆç”¨</h3><h3 id="æ€»æ•ˆç”¨ä¸è¾¹é™…æ•ˆç”¨"><a href="#æ€»æ•ˆç”¨ä¸è¾¹é™…æ•ˆç”¨" class="headerlink" title="æ€»æ•ˆç”¨ä¸è¾¹é™…æ•ˆç”¨"></a>æ€»æ•ˆç”¨ä¸è¾¹é™…æ•ˆç”¨</h3>]]></content>
      <categories>
        <category>F0601</category>
      </categories>
      <tags>
        <tag>F0601</tag>
      </tags>
  </entry>
  <entry>
    <title>å†³ç­–çš„åŸºæœ¬æ¦‚å¿µ</title>
    <url>/2023/03/10/%E5%86%B3%E7%AD%96%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</url>
    <content><![CDATA[<h2 id="å†³ç­–çš„åŸºæœ¬æ¦‚å¿µ"><a href="#å†³ç­–çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="å†³ç­–çš„åŸºæœ¬æ¦‚å¿µ"></a>å†³ç­–çš„åŸºæœ¬æ¦‚å¿µ</h2><span id="more"></span>
<h3 id="å†³ç­–çš„æ¦‚å¿µ"><a href="#å†³ç­–çš„æ¦‚å¿µ" class="headerlink" title="å†³ç­–çš„æ¦‚å¿µ"></a><strong>å†³ç­–çš„æ¦‚å¿µ</strong></h3><p>ç‹­ä¹‰ç†è§£ï¼šå†³ç­–å°±æ˜¯åšå‡ºå†³å®šï¼Œä»…é™äºäººä»¬ä»ä¸æ–¹æ¡ˆä¸­åšå‡ºæœ€ä½³é€‰æ‹©</p>
<p>å¹¿ä¹‰ç†è§£ï¼šæŠŠå†³ç­–çœ‹ä½œä¸€ä¸ªè¿‡ç¨‹ï¼›å³äººä»¬ä¸ºäº†å®ç°æŸä¸€ç›®æ ‡ï¼Œåœ¨å æœ‰ä¸€å®šä¿¡æ¯å’Œç»éªŒçš„åŸºç¡€ä¸Šï¼Œæ ¹æ®ä¸»å®¢è§‚æ¡ä»¶çš„å¯èƒ½æ€§ï¼Œæå‡ºå„ç§å¯è¡Œçš„æ–¹æ¡ˆï¼Œé‡‡ç”¨ä¸€å®šçš„ç§‘å­¦æ–¹æ³•å’Œæ‰‹æ®µï¼Œè¿›è¡Œæ¯”è¾ƒï¼Œåˆ†æå’Œè¯„ä»·ï¼ŒæŒ‰ç…§å†³ç­–å‡†åˆ™ï¼Œä»ä¸­ç­›é€‰å‡ºæœ€æ»¡æ„æ–¹æ¡ˆï¼Œå¹¶æ ¹æ®æ–¹æ¡ˆå®æ–½çš„åé¦ˆæƒ…å†µè¿›è¡Œä¿®æ•´æ§åˆ¶ç›´è‡³ç›®æ ‡å®ç°çš„æ•´ä¸ªç³»ç»Ÿè¿‡ç¨‹ã€‚</p>
<h3 id="åŸºæœ¬è¦ç´ "><a href="#åŸºæœ¬è¦ç´ " class="headerlink" title="åŸºæœ¬è¦ç´ "></a><strong>åŸºæœ¬è¦ç´ </strong></h3><p> å†³ç­–è€…ï¼šå†³ç­–è€…å³å†³ç­–ä¸»ä½“ï¼Œå¯ä»¥æ˜¯ä¸ªä½“ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¾¤ä½“ã€‚</p>
<p> å†³ç­–ç›®æ ‡ï¼šå†³ç­–è€…å¿…é¡»æœ‰ä¸€ä¸ªå¸Œ æœ›è¾¾åˆ°çš„æ˜ç¡®çš„ç›®æ ‡ï¼Œå¯ä»¥æ˜¯å•ä¸ªç›®æ ‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ å¤šä¸ªç›®æ ‡ã€‚</p>
<p> å†³ç­–æ–¹æ¡ˆï¼šå­˜åœ¨ç€ä¾›äººä»¬é€‰æ‹©çš„ä¸åŒçš„å†³ç­–æ–¹æ¡ˆ</p>
<p> è‡ªç„¶çŠ¶æ€ï¼šå†³ç­–è€…æ— æ³•æ§åˆ¶ä½†å¯ä»¥é¢„è§çš„å†³ç­–ç¯å¢ƒå®¢è§‚å­˜åœ¨çš„å„ç§çŠ¶æ€ã€‚</p>
<p> å†³ç­–åæœï¼šå³å„ç§å†³ç­–æ–¹æ¡ˆåœ¨ä¸åŒè‡ªç„¶çŠ¶æ€ä¸‹æ‰€å‡ºç°çš„ç»“æœã€‚</p>
<p> å†³ç­–å‡†åˆ™ï¼šæ˜¯è¯„ä»·æ–¹æ¡ˆæ˜¯å¦è¾¾åˆ°å†³ç­–ç›®æ ‡çš„ä»·å€¼æ ‡å‡†ï¼Œä¹Ÿæ˜¯é€‰æ‹©æ–¹æ¡ˆçš„ä¾æ®ã€‚</p>
<h3 id="åŸºæœ¬æ­¥éª¤"><a href="#åŸºæœ¬æ­¥éª¤" class="headerlink" title="åŸºæœ¬æ­¥éª¤"></a><strong>åŸºæœ¬æ­¥éª¤</strong></h3><p> å‘ç°å’Œåˆ†æé—®é¢˜</p>
<p> ç¡®å®šå†³ç­–ç›®æ ‡</p>
<p> æ‹Ÿå®šå„ç§å¯è¡Œæ–¹æ¡ˆ<br> åˆ†ææ¯”è¾ƒå„ç§å¤‡æ‹©æ–¹æ¡ˆï¼Œä»ä¸­é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ</p>
<p> å†³ç­–çš„æ‰§è¡Œï¼Œåé¦ˆä¸è°ƒæ•´</p>
<p><img src="/2023/03/10/%E5%86%B3%E7%AD%96%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/å†³ç­–æ­¥éª¤.png" alt="å†³ç­–æ­¥éª¤"></p>
<h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><p>ï¼Ÿï¼Ÿï¼Ÿ</p>
<h3 id="å†³ç­–çš„åˆ†ç±»"><a href="#å†³ç­–çš„åˆ†ç±»" class="headerlink" title="å†³ç­–çš„åˆ†ç±»"></a><em>å†³ç­–çš„åˆ†ç±»</em></h3><div class="table-container">
<table>
<thead>
<tr>
<th>åˆ†ç±»è§’åº¦</th>
<th>åˆ†ç±»</th>
</tr>
</thead>
<tbody>
<tr>
<td>å†³ç­–ä¸»ä½“</td>
<td>ä¸ªäºº\</td>
<td>ç»„ç»‡</td>
</tr>
<tr>
<td>å†³ç­–å½±å“èŒƒå›´</td>
<td>æˆ˜ç•¥\</td>
<td>ç®¡ç†\</td>
<td>ä¸šåŠ¡</td>
</tr>
<tr>
<td>å†³ç­–ç¨‹åºçš„è§„èŒƒæ€§</td>
<td>ç¨‹åºåŒ–\</td>
<td>éç¨‹åºåŒ–</td>
</tr>
<tr>
<td>å†³ç­–çš„ç¡®å®šæ€§</td>
<td>ç¡®å®šæ€§\</td>
<td>ä¸ç¡®å®šå‹</td>
</tr>
<tr>
<td>å†³ç­–è¿‡ç¨‹çš„è¿ç»­æ€§</td>
<td>å•é¡¹\</td>
<td>åºè´¯</td>
</tr>
<tr>
<td>å†³ç­–ç›®æ ‡ä¸ªæ•°</td>
<td>å•ç›®æ ‡\</td>
<td>å¤šç›®æ ‡</td>
</tr>
<tr>
<td>å®šæ€§å®šé‡ç‰¹æ€§</td>
<td>å®šé‡\</td>
<td>å®šæ€§</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å®é™…å†³ç­–è¿‡ç¨‹çš„éš¾ç‚¹"><a href="#å®é™…å†³ç­–è¿‡ç¨‹çš„éš¾ç‚¹" class="headerlink" title="å®é™…å†³ç­–è¿‡ç¨‹çš„éš¾ç‚¹"></a>å®é™…å†³ç­–è¿‡ç¨‹çš„éš¾ç‚¹</h3><p>â€‹    æ— æ³•ç¡®ä¿å†³ç­–æªæ–½å¾—ä»¥é¡ºåˆ©å®æ–½çš„â€œç°å®å‰ææ¡ä»¶â€ä¸å†³ç­–è€…å¿ƒä¸­å¢¨è®¤çš„ â€œç†æƒ³æ¡ä»¶â€æ˜¯å¦ä¸€è‡´,æ˜¯å†³ç­–äººæœ€éœ€è¦é‡è§†çš„é—®é¢˜,å…¨é¢æ­£ç¡®çš„åˆ†æâ€œç°å®å‰ææ¡ä»¶â€ä¸â€œç† æƒ³æ¡ä»¶â€çš„å·®å¼‚æ˜¯å†³ç­–çš„ä¸»è¦éš¾ç‚¹.æ— è®ºæ˜¯å¤§ æ–¹å‘ä¸Šçš„å†³ç­–æªæ–½,è¿˜æ˜¯å†³ç­–ä¸­çš„ç»†åˆ†è®¡åˆ’, è¦æƒ³é¡ºåˆ©å®æ–½å¿…ç„¶æœ‰å…¶å„è‡ªçš„å‰ææ¡ä»¶,æˆ‘ä»¬ç§°è¿™äº›å‰ææ¡ä»¶ä¸ºâ€œç†æƒ³æ¡ä»¶â€,å½“ç° å® æ¡ä»¶ ä¸ è¿™ ä¸ªå‰ æ ä¸ ç›¸é€‚ åº” æ—¶,å°±è¦æƒ³åŠæ³•æ‰“é€šè¿™äº›ç¯èŠ‚,å°½å¯èƒ½è®©ç°æ¡ä»¶ä¸å†³ç­–ç†æƒ³æ¡ä»¶ç›¸ç¬¦, è¿™æ ·å†³ç­–æªæ–½æ‰èƒ½é¡ºåˆ©å®æ–½,æœ€ç»ˆè¾¾åˆ°å†³ç­–è€…çš„ç›®çš„.å¦‚æœäº‹å…ˆå¯¹â€œç°å®å‰ææ¡ä»¶â€ ä¸â€œç†æƒ³æ¡ä»¶â€çš„å·®å¼‚åˆ†æä¸å¤Ÿå¾€å¾€å°±å¯¼è‡´é—®é¢˜çš„è§£å†³ä¸å½»åº•,ä¹Ÿå°±ç›´æ¥å½±å“åˆ°å†³ç­–æªæ–½æ˜¯å¦èƒ½å¤Ÿæœ€ç»ˆé¡ºåˆ©å®æ–½.æ‰€ä»¥æ­£ç¡®åˆ†æè¿™é‡Œçš„â€œå·®å¼‚â€æ˜¯ç›¸å½“é‡è¦çš„.</p>
<h3 id="ä¸»è¦çš„å†³ç­–é™·é˜±"><a href="#ä¸»è¦çš„å†³ç­–é™·é˜±" class="headerlink" title="ä¸»è¦çš„å†³ç­–é™·é˜±"></a>ä¸»è¦çš„å†³ç­–é™·é˜±</h3><p>â€œæ²‰é”šâ€é™·é˜±ï¼š</p>
<p>â€œæœ‰åˆ©è¯æ®â€é™·é˜±</p>
<p>â€œæ¡†æ¶â€é™·é˜±ï¼š</p>
<p>â€œéœå¸ƒæ£®é€‰æ‹©â€çš„é™·é˜±</p>
<p>â€œå¸ƒé‡Œä¸¹é€‰æ‹©â€çš„é™·é˜±</p>
<p>â€œç¾¤ä½“æ€ç»´â€çš„é™·é˜±</p>
]]></content>
      <categories>
        <category>F0601</category>
      </categories>
      <tags>
        <tag>F0601</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoåšå®¢</title>
    <url>/2023/03/09/hexo%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h1 id="åœ¨giteeæ­å»ºhexo"><a href="#åœ¨giteeæ­å»ºhexo" class="headerlink" title="åœ¨giteeæ­å»ºhexo"></a>åœ¨giteeæ­å»ºhexo</h1><h4 id="å®‰è£…Node-jsç¯å¢ƒ"><a href="#å®‰è£…Node-jsç¯å¢ƒ" class="headerlink" title="å®‰è£…Node.jsç¯å¢ƒ"></a>å®‰è£…Node.jsç¯å¢ƒ</h4><p><a href="http://nodejs.cn/download/">http://nodejs.cn/download/</a> </p>
<span id="more"></span>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¡®è®¤node.jså®‰è£…æˆåŠŸï¼šè¿è¡Œä¸‹é¢ä¸¤ä¸ªå‘½ä»¤æ‰“å°ç‰ˆæœ¬å·å³å¯</span></span><br><span class="line">node -v</span><br><span class="line">npm  -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Node.js æ·˜å®é•œåƒåŠ é€Ÿå™¨ ï¼ˆcnpmï¼‰</span></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ node ç±»åº“é»˜è®¤å®‰è£…ä½ç½®</span></span><br><span class="line"><span class="comment"># é»˜è®¤æ˜¯åœ¨ C:\Users\lingStudy\AppData\Roaming\npm</span></span><br><span class="line"></span><br><span class="line">npm config <span class="built_in">set</span> prefix <span class="string">&quot;D:\nodejså®‰è£…è·¯å¾„\node_global&quot;</span></span><br><span class="line">npm config <span class="built_in">set</span> cache <span class="string">&quot;D:\nodejså®‰è£…è·¯å¾„\node_cache&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å°¤å…¶è¦æ³¨æ„ç¯å¢ƒå˜é‡çš„è®¾ç½®</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä¿®æ”¹æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">npm root -g</span><br><span class="line"><span class="comment"># ç„¶åæŠŠD:\install\node\node_globalé…ç½®åˆ°ç¯å¢ƒå˜é‡çš„ PATH ä¸‹å³å¯</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="å®‰è£…ç‰ˆæœ¬æ§åˆ¶å·¥å…·-Git"><a href="#å®‰è£…ç‰ˆæœ¬æ§åˆ¶å·¥å…·-Git" class="headerlink" title="å®‰è£…ç‰ˆæœ¬æ§åˆ¶å·¥å…· Git"></a>å®‰è£…ç‰ˆæœ¬æ§åˆ¶å·¥å…· Git</h4><p>ç”¨æ¥å°†æœ¬åœ°é¡¹ç›®æ‰˜ç®¡åˆ°ç äº‘ï¼Œæ‰€ä»¥è¿˜éœ€è¦è‡ªå·±æ³¨å†Œä¸€ä¸ªç äº‘çš„è´¦å·ã€‚</p>
<p><a href="https://git-scm.com/download">https://git-scm.com/download</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Gitä¸€äº›é‡è¦é…ç½®</span></span><br><span class="line">git config --global user.name <span class="string">&quot;lxxxxdy&quot;</span>  <span class="comment">#ç äº‘ç”¨æˆ·å</span></span><br><span class="line">git config --global user.email <span class="string">&quot;xxx83@qq.com&quot;</span>   <span class="comment">#é‚®ç®±</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”ŸæˆSSHå…¬é’¥å¹¶æ·»åŠ åˆ°ç äº‘ï¼Œå®ç°å…å¯†ç ç™»å½•</span></span><br><span class="line"><span class="comment"># 1ã€ç”Ÿæˆå…¬é’¥</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"><span class="comment"># 2ã€è¿›å…¥ C:\Users\ä¸»æœºå\.ssh ç›®å½•ï¼ŒæŠŠ id_rsa.pub é‡Œé¢çš„ä¿¡æ¯å¤åˆ¶åˆ°ç äº‘çš„ SSHå…¬é’¥ ä¸­å³å¯</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Hexo-å®˜ç½‘"><a href="#Hexo-å®˜ç½‘" class="headerlink" title="Hexo å®˜ç½‘"></a>Hexo å®˜ç½‘</h4><p> <a href="https://hexo.io/zh-cn/">https://hexo.io/zh-cn/</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ï¼Œhexoblog æ˜¯é¡¹ç›®å</span></span><br><span class="line">hexo init  hexoblog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1ã€è¿›å…¥hexoblogé¡¹ç›®ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> hexoblog</span><br><span class="line"><span class="comment">#/2ã€å®‰è£… hexoblog é¡¹ç›®çš„ä¾èµ–åŒ…</span></span><br><span class="line">npm install</span><br><span class="line"><span class="comment">#/3ã€å¯åŠ¨ hexoblog é¡¹ç›®æœåŠ¡</span></span><br><span class="line">hexo server</span><br><span class="line"><span class="comment">#æ­¤æ—¶ï¼Œè®¿é—® http://localhost:4000/ å³å¯çœ‹åˆ° hexo é»˜è®¤çš„é¡µé¢å’Œä¸€ç¯‡â€œHello Worldâ€é»˜è®¤ç”Ÿæˆçš„æ–‡ç« </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ .deploy       <span class="comment"># éœ€è¦éƒ¨ç½²çš„æ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ node_modules  <span class="comment"># é¡¹ç›®æ‰€æœ‰çš„ä¾èµ–åŒ…å’Œæ’ä»¶</span></span><br><span class="line">â”œâ”€â”€ public        <span class="comment"># ç”Ÿæˆçš„é™æ€ç½‘é¡µæ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ scaffolds     <span class="comment"># æ–‡ç« æ¨¡æ¿</span></span><br><span class="line">â”œâ”€â”€ <span class="built_in">source</span>        <span class="comment"># åšå®¢æ­£æ–‡å’Œå…¶ä»–æºæ–‡ä»¶ç­‰éƒ½åº”è¯¥æ”¾åœ¨è¿™é‡Œ</span></span><br><span class="line">|   â”œâ”€â”€ _drafts   <span class="comment"># è‰ç¨¿</span></span><br><span class="line">|   â””â”€â”€ _posts    <span class="comment"># æ–‡ç« </span></span><br><span class="line">â”œâ”€â”€ themes        <span class="comment"># ä¸»é¢˜</span></span><br><span class="line">â”œâ”€â”€ _config.yml   <span class="comment"># å…¨å±€é…ç½®æ–‡ä»¶</span></span><br><span class="line">â””â”€â”€ package.json  <span class="comment"># é¡¹ç›®ä¾èµ–ä¿¡æ¯</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="å°†é¡¹ç›®éƒ¨ç½²åˆ°ç äº‘"><a href="#å°†é¡¹ç›®éƒ¨ç½²åˆ°ç äº‘" class="headerlink" title="å°†é¡¹ç›®éƒ¨ç½²åˆ°ç äº‘"></a>å°†é¡¹ç›®éƒ¨ç½²åˆ°ç äº‘</h4><p>åœ¨ç äº‘æ–°å»ºä¸€ä¸ªä»“åº“,ä»“åº“åå’Œè·¯å¾„è¦ä¸ç”¨æˆ·åä¸€è‡´ã€‚</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å®‰è£…gitéƒ¨ç½²æ’ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¹‹åå°±å¯ä»¥ä½¿ç”¨ hexo deployï¼ˆæˆ–ç®€å†™ hexo dï¼‰å°†é¡¹ç›®éƒ¨ç½²åˆ°giteeè¿œç¨‹ä»“åº“</span></span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶ï¼š_config.ymlï¼Œåœ¨æœ€ä¸‹é¢ï¼Œä¿®æ”¹å¦‚ä¸‹å†…å®¹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">ä»“åº“URLåœ°å€</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å‘½ä»¤ <strong>hexo d</strong> å°†é¡¹ç›®éƒ¨ç½²åˆ° gitee è¿œç¨‹ä»“åº“ï¼Œæ­¤æ—¶æœ¬åœ°æ–‡ä»¶å¤¹ä¸­å‡ºç°æœ‰ä¸€ä¸ªpublicæ–‡ä»¶å¤¹ã€‚</p>
<p>å¼€å¯ Gitee Pages é™æ€ç½‘é¡µæ‰˜ç®¡æœåŠ¡</p>
<p>nextä¸»é¢˜ä¼˜åŒ–ç½‘ä¸Šå¾ˆå¤šã€‚</p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>gitee</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2023/03/09/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<span id="more"></span>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šæ™ºèƒ½ä½“å¯¹æŠ—</title>
    <url>/2023/03/08/%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E5%AF%B9%E6%8A%97/</url>
    <content><![CDATA[<h1 id="æ¯•ä¸šè®¾è®¡æ€è·¯åŠå®ç°"><a href="#æ¯•ä¸šè®¾è®¡æ€è·¯åŠå®ç°" class="headerlink" title="æ¯•ä¸šè®¾è®¡æ€è·¯åŠå®ç°"></a>æ¯•ä¸šè®¾è®¡æ€è·¯åŠå®ç°</h1><h2 id="æ— äººæœºé›†ç¾¤ç©ºæˆ˜æ”»é˜²å¯¹æŠ—æ¨¡å‹è®¾è®¡"><a href="#æ— äººæœºé›†ç¾¤ç©ºæˆ˜æ”»é˜²å¯¹æŠ—æ¨¡å‹è®¾è®¡" class="headerlink" title="æ— äººæœºé›†ç¾¤ç©ºæˆ˜æ”»é˜²å¯¹æŠ—æ¨¡å‹è®¾è®¡"></a>æ— äººæœºé›†ç¾¤ç©ºæˆ˜æ”»é˜²å¯¹æŠ—æ¨¡å‹è®¾è®¡</h2><h3 id="å¯¹æŠ—åœºæ™¯æ¨¡å‹è®¾è®¡"><a href="#å¯¹æŠ—åœºæ™¯æ¨¡å‹è®¾è®¡" class="headerlink" title="å¯¹æŠ—åœºæ™¯æ¨¡å‹è®¾è®¡"></a>å¯¹æŠ—åœºæ™¯æ¨¡å‹è®¾è®¡</h3><span id="more"></span>
<ol>
<li><h4 id="ä½œæˆ˜å•å…ƒè®¾è®¡"><a href="#ä½œæˆ˜å•å…ƒè®¾è®¡" class="headerlink" title="ä½œæˆ˜å•å…ƒè®¾è®¡"></a>ä½œæˆ˜å•å…ƒè®¾è®¡</h4><ul>
<li><p>å•å…ƒç§ç±»</p>
<ul>
<li>æ”»å‡»å•å…ƒ</li>
<li>æ¢æµ‹å•å…ƒ</li>
</ul>
</li>
<li><p>å•å…ƒæ•°é‡</p>
<ul>
<li>3ä¸ª</li>
<li>2ä¸ª</li>
</ul>
</li>
<li><p>ä½ç½®åˆ†å¸ƒ</p>
<p>â€‹    å¯¹ç§°åˆ†å¸ƒåœ¨ä¸¤ä¾§</p>
</li>
<li><p>å•å…ƒå±æ€§</p>
<ul>
<li>æ”»å‡»å•å…ƒï¼šå•å…ƒå¤§å°$size$ï¼Œæ”»å‡»èŒƒå›´$scope$ï¼Œä½ç½®åæ ‡$(pos_x ï¼Œpos_y),$é€Ÿåº¦$(vel_x,vel_y)$ï¼Œå‘¨å›´æ•Œæ–¹æ™ºèƒ½ä½“æ•°é‡$num_adv$ , æœ‰æ•ˆæ”»å‡»æ¬¡æ•°$times_{attack}$,è¢«æ”»å‡»æ¬¡æ•°$num_{hited}$ã€‚</li>
<li>æ¢æµ‹å•å…ƒï¼šå•å…ƒå¤§å°$size$ï¼Œæ”»å‡»èŒƒå›´$scope$ï¼Œä½ç½®åæ ‡$(pos_x ï¼Œpos_y),$é€Ÿåº¦$(vel_x,vel_y)$ï¼Œå‘¨å›´æ•Œæ–¹æ™ºèƒ½ä½“æ•°é‡$num_adv$ , æœ‰æ•ˆæ”»å‡»æ¬¡æ•°$times_{search}$,è¢«æ”»å‡»æ¬¡æ•°$num_{hited}$ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><h4 id="å¯¹æŠ—è§„åˆ™è®¾è®¡"><a href="#å¯¹æŠ—è§„åˆ™è®¾è®¡" class="headerlink" title="å¯¹æŠ—è§„åˆ™è®¾è®¡"></a>å¯¹æŠ—è§„åˆ™è®¾è®¡</h4><p>çº¢æ–¹é‡‡ç”¨æ™ºèƒ½ç®—æ³•æ§åˆ¶ï¼Œä½¿æ™ºèƒ½ä½“è‡ªä¸»å†³ç­–ï¼Œè“æ–¹é‡‡ç”¨æ—¢å®šå¯¹æŠ—ç­–ç•¥ã€‚</p>
<h5 id="çº¢æ–¹ç®—æ³•é€‰æ‹©"><a href="#çº¢æ–¹ç®—æ³•é€‰æ‹©" class="headerlink" title="çº¢æ–¹ç®—æ³•é€‰æ‹©"></a>çº¢æ–¹ç®—æ³•é€‰æ‹©</h5><ul>
<li>MADDPG</li>
</ul>
<h5 id="è“æ–¹å¯¹æŠ—ç­–ç•¥"><a href="#è“æ–¹å¯¹æŠ—ç­–ç•¥" class="headerlink" title="è“æ–¹å¯¹æŠ—ç­–ç•¥"></a>è“æ–¹å¯¹æŠ—ç­–ç•¥</h5><h6 id="æ”»å‡»å•å…ƒ"><a href="#æ”»å‡»å•å…ƒ" class="headerlink" title="æ”»å‡»å•å…ƒ"></a>æ”»å‡»å•å…ƒ</h6><ul>
<li>å½“æ”»å‡»èŒƒå›´å†…æ— å¤„äºæ¢æµ‹å•å…ƒæ¢æµ‹è§†è§’ä¸‹çš„è¢«æ”»å‡»å•å…ƒï¼Œåˆ™è¶‹å‘æœ€è¿‘çš„è¯¥ç±»å‹å•å…ƒï¼› </li>
<li>å¦åˆ™ï¼Œæ”»å‡»å•å…ƒé™æ­¢å¹¶è½¬ä¸ºæ”»å‡»çŠ¶æ€</li>
</ul>
<h6 id="æ¢æµ‹å•å…ƒ"><a href="#æ¢æµ‹å•å…ƒ" class="headerlink" title="æ¢æµ‹å•å…ƒ"></a>æ¢æµ‹å•å…ƒ</h6><ul>
<li>å½“æ¢æµ‹èŒƒå›´å†…æœ‰è¢«æ¢æµ‹å•å…ƒï¼Œæ¢æµ‹å•å…ƒé™æ­¢ï¼›</li>
<li>å½“æ¢æµ‹èŒƒå›´å†…æ— è¢«æ¢æµ‹å•å…ƒæ—¶ï¼Œå¦‚å­˜åœ¨æœªè¢«æ¢æµ‹åˆ°æ”»å‡»å·±æ–¹å•å…ƒçš„æ•Œæ–¹æ”»å‡»å•å…ƒï¼Œåˆ™è¶‹å‘æœ€è¿‘çš„è¯¥ç±»å‹å•å…ƒï¼›</li>
<li>å¦åˆ™è¶‹å‘æœ€è¿‘çš„è¢«æ¢æµ‹å•å…ƒã€‚</li>
</ul>
</li>
<li><h4 id="åˆ¤åˆ«è§„åˆ™è®¾è®¡"><a href="#åˆ¤åˆ«è§„åˆ™è®¾è®¡" class="headerlink" title="åˆ¤åˆ«è§„åˆ™è®¾è®¡"></a>åˆ¤åˆ«è§„åˆ™è®¾è®¡</h4><p>èƒœè´Ÿæ€§åˆ¤åˆ«ï¼šè®¾ç½®æœ€å¤§ä»¿çœŸæ­¥æ•°ä¸º25æ­¥ï¼Œåœ¨å¯¹å±€ç»“æŸæ—¶æŒ‰ç…§åŒæ–¹å„å•å…ƒæ”»å‡»æ¬¡æ•°/æ¢æµ‹æ¬¡æ•°ä¸è¢«æ”»å‡»/æ¢æµ‹æ¬¡æ•°å¤§å°æ¯”è¾ƒåˆ¤å®šã€‚</p>
</li>
</ol>
<h3 id="åŠ¨ä½œè®¾è®¡"><a href="#åŠ¨ä½œè®¾è®¡" class="headerlink" title="åŠ¨ä½œè®¾è®¡"></a>åŠ¨ä½œè®¾è®¡</h3><p>â€‹    è€ƒè™‘æ™ºèƒ½ä½“åœ¨äºŒç»´å¹³é¢å†…ç§»åŠ¨ï¼ŒåŠ¨ä½œä¸ºè¿ç»­åŠ¨ä½œï¼Œæ—¶é—´ç¦»æ•£ã€‚åŠ é€Ÿåº¦å’Œé€Ÿåº¦éƒ½æ˜¯è¿ç»­æœ‰ç•Œçš„ã€‚</p>
<h3 id="çŠ¶æ€è§‚æµ‹"><a href="#çŠ¶æ€è§‚æµ‹" class="headerlink" title="çŠ¶æ€è§‚æµ‹"></a>çŠ¶æ€è§‚æµ‹</h3><p>â€‹    æ™ºèƒ½ä½“è·å¾—å·±æ–¹æ™ºèƒ½ä½“çš„ä½ç½®ï¼Œé€Ÿåº¦ä¿¡æ¯ï¼Œä»¥åŠåœ¨æ™ºèƒ½ä½“æ”»å‡»æˆ–æ¢æµ‹èŒƒå›´å†…çš„æ™ºèƒ½ä½“ä¿¡æ¯ã€‚</p>
<h3 id="å¥–åŠ±è®¾è®¡"><a href="#å¥–åŠ±è®¾è®¡" class="headerlink" title="å¥–åŠ±è®¾è®¡"></a>å¥–åŠ±è®¾è®¡</h3><h4 id="å®šæ€§è®¾è®¡"><a href="#å®šæ€§è®¾è®¡" class="headerlink" title="å®šæ€§è®¾è®¡"></a>å®šæ€§è®¾è®¡</h4><p><img src="/2023/03/08/%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E5%AF%B9%E6%8A%97/å¥–åŠ±å‡½æ•°è®¾è®¡.jpg" alt="å¥–åŠ±å‡½æ•°è®¾è®¡"></p>
<h4 id="å®šé‡è®¾è®¡"><a href="#å®šé‡è®¾è®¡" class="headerlink" title="å®šé‡è®¾è®¡"></a>å®šé‡è®¾è®¡</h4><p>$reward = r_episode+r_attack+r_search$</p>
<h5 id="å›åˆå¥–åŠ±"><a href="#å›åˆå¥–åŠ±" class="headerlink" title="å›åˆå¥–åŠ±"></a>å›åˆå¥–åŠ±</h5><script type="math/tex; mode=display">
r\_episode=\left\{
\begin{align}
+100 \qquad å®Œå…¨èƒœåˆ©ï¼Œæ”»å‡»æ¬¡æ•°ä¸æ¢æµ‹æ¬¡æ•°éƒ½å¤šäºæ•Œæ–¹\\
+50 \qquad å°èƒœåˆ©ï¼Œæ”»å‡»æ¬¡æ•°ä¸æ¢æµ‹æ¬¡æ•°æ€»æ•°å¤šäºæ•Œæ–¹\\
0\qquad å¹³å±€ï¼Œæ”»å‡»æ¬¡æ•°ä¸æ¢æµ‹æ¬¡æ•°æ€»æ•°ç­‰æ•Œæ–¹\\
-50 \qquad å°å¤±è´¥ï¼Œæ”»å‡»æ¬¡æ•°ä¸æ¢æµ‹æ¬¡æ•°æ€»æ•°å°‘äºæ•Œæ–¹\\
-100\qquad å®Œå…¨å¤±è´¥ï¼Œæ”»å‡»æ¬¡æ•°ä¸æ¢æµ‹æ¬¡æ•°éƒ½å°‘äºæ•Œæ–¹
\end{align}
\right.</script><p>æ”»å‡»å•å…ƒå¥–åŠ±å‡½æ•°è®¾è®¡</p>
<script type="math/tex; mode=display">
r=r_{1}+r_{2}+r_{3}\\
\left\{
\begin{align}
r_{1}&=r_{1}+10,    \qquad æ”»å‡»æ•Œæ–¹ä¸€æ¬¡\\
r_{2}&=r_{2}-10,    \qquad è¢«æ”»å‡»ä¸€æ¬¡\\
r_{3}&=r_{3}-5,    \qquad è¢«æ¢æµ‹ä¸€æ¬¡\\
r_{4}&=r_{4}-5,\qquad ç¢°æ’è¾¹ç•Œ
\end{align}
\right.</script><h5 id="æ¢æµ‹å•å…ƒå¥–åŠ±å‡½æ•°è®¾è®¡"><a href="#æ¢æµ‹å•å…ƒå¥–åŠ±å‡½æ•°è®¾è®¡" class="headerlink" title="æ¢æµ‹å•å…ƒå¥–åŠ±å‡½æ•°è®¾è®¡"></a>æ¢æµ‹å•å…ƒå¥–åŠ±å‡½æ•°è®¾è®¡</h5><script type="math/tex; mode=display">
r=r_{1}+r_{2}+r_{3}\\
\left\{
\begin{align}
r_{1}&=r_{1}+8,    \qquad æ¢æµ‹æ•Œæ–¹ä¸€æ¬¡\\
r_{2}&=r_{2}-8,    \qquad è¢«æ”»å‡»ä¸€æ¬¡\\
r_{3}&=r_{3}-4,    \qquad è¢«æ¢æµ‹ä¸€æ¬¡\\
r_{4}&=r_{4}-5,\qquad ç¢°æ’è¾¹ç•Œ
\end{align}
\right.</script><h2 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h2><h3 id="å¹³å°"><a href="#å¹³å°" class="headerlink" title="å¹³å°"></a>å¹³å°</h3><p>å®éªŒè½¯ä»¶ç¯å¢ƒä¸º Windows10 æ“ä½œç³»ç»Ÿ; pytorchæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼›ç¡¬ä»¶ç¯å¢ƒä¸ºIntel(R) Core(TM) i7-9750H CPUï¼›NVIDIA GeForce GTX 1650</p>
<h3 id="ä»¿çœŸç¯å¢ƒ"><a href="#ä»¿çœŸç¯å¢ƒ" class="headerlink" title="ä»¿çœŸç¯å¢ƒ"></a>ä»¿çœŸç¯å¢ƒ</h3><p>åŸºç¡€ç¯å¢ƒï¼š<a href="https://github.com/openai/multiagent-particle-envs">Multi-Agent Particle Environment</a>ç¯å¢ƒ<br>æ ¹æ®å¯¹æŠ—åœºæ™¯è®¾è®¡ï¼Œæ„å»ºè‡ªå·±çš„ç¯å¢ƒã€‚</p>
<h3 id="ç®—æ³•åŸç†"><a href="#ç®—æ³•åŸç†" class="headerlink" title="ç®—æ³•åŸç†"></a>ç®—æ³•åŸç†</h3><p>ç®—æ³•æ¨¡å‹ç”±å¤šä¸ªDDPGç½‘ç»œç»„æˆï¼Œæ¯ä¸ªç½‘ç»œå­¦ä¹ policy Ï€ (Actor) å’Œ action value Q (Critic)ï¼›åŒæ—¶å…·æœ‰target networkï¼Œç”¨äºQ-learningçš„off-policyå­¦ä¹ ã€‚ç®—æ³•æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/2023/03/08/%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E5%AF%B9%E6%8A%97/æ€»è§ˆå›¾.png" alt="æ€»è§ˆå›¾"></p>
<p>æ¯ä¸ªæ™ºèƒ½ä½“ç”¨ Actor-Critic çš„æ–¹æ³•è®­ç»ƒï¼Œåœ¨ MADDPG ä¸­æ¯ä¸ªæ™ºèƒ½ä½“çš„ Critic éƒ¨åˆ†éƒ½èƒ½å¤Ÿè·å¾—å…¶ä»–æ™ºèƒ½ä½“çš„ç­–ç•¥ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œè€ƒè™‘ä¸€ä¸ªæœ‰$N$ä¸ªæ™ºèƒ½ä½“çš„åšå¼ˆï¼Œæ¯ä¸ªæ™ºèƒ½ä½“çš„ç­–ç•¥å‚æ•°ä¸º$\theta = \left \{  \theta_{1},â€¦\theta_{N}  \right \}$ ,è®°$\pi = \left \{ \pi_{1},â€¦â€¦,\pi_{N} \right \} $ ä¸ºæ‰€æœ‰æ™ºèƒ½ä½“çš„ç­–ç•¥é›†åˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†™å‡ºåœ¨éšæœºæ€§ç­–ç•¥æƒ…å†µä¸‹æ¯ä¸ªæ™ºèƒ½ä½“çš„ç´¯ç§¯æœŸæœ›å¥–åŠ±$J\left(\theta_{i}\right)=E_{s \sim \rho^{\pi}, a_{i} \sim \pi_{\theta_{i}}}\left[\sum_{t=0}^{\infty} \gamma^{t} r_{i, t}\right]$ ,é’ˆå¯¹éšæœºç­–ç•¥ï¼Œæ±‚ç­–ç•¥æ¢¯åº¦ä¸ºï¼š</p>
<script type="math/tex; mode=display">
J\left(\theta_{i}\right)=E_{s \sim \rho^{\pi}, a_{i} \sim \pi_{\theta_{i}}}\left[\sum_{t=0}^{\infty} \gamma^{t} r_{i, t}\right]\nabla_{\theta_{i}} J\left(\theta_{i}\right)=\mathbb{E}_{s \sim p^{\mu}, a \sim \pi_{i}}\left[\nabla_{\theta_{i}} \log \pi_{i}\left(a_{i} \mid o_{i}\right) Q_{i}^{\pi}\left(\mathbf{x}, a_{1}, \ldots, a_{N}\right)\right]</script><p>å…¶ä¸­ï¼Œ$Q_{i}^{\pi}\left(\mathbf{x}, a_{1}, \ldots, a_{N}\right)$å°±æ˜¯ä¸€ä¸ªä¸­å¿ƒåŒ–çš„åŠ¨ä½œä»·å€¼å‡½æ•°ã€‚ä¸ºä»€ä¹ˆè¯´$Q_{i}$æ˜¯ä¸€ä¸ªä¸­å¿ƒåŒ–çš„åŠ¨ä½œä»·å€¼å‡½æ•°å‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´$x=(o_{1},â€¦,o_{N})$åŒ…å«äº†æ‰€æœ‰æ™ºèƒ½ä½“çš„è§‚æµ‹ï¼Œå¦å¤–$Q_{i}$ä¹Ÿéœ€è¦è¾“å…¥æ‰€æœ‰æ™ºèƒ½ä½“åœ¨æ­¤åˆ»çš„åŠ¨ä½œï¼Œå› æ­¤$Q_{i}$å·¥ä½œçš„å‰æå°±æ˜¯æ‰€æœ‰æ™ºèƒ½ä½“è¦åŒæ—¶ç»™å‡ºè‡ªå·±çš„è§‚æµ‹å’Œç›¸åº”çš„åŠ¨ä½œã€‚</p>
<p>å¯¹äºç¡®å®šæ€§ç­–ç•¥æ¥è¯´ï¼Œè€ƒè™‘ç°åœ¨æœ‰Nä¸ªè¿ç»­çš„ç­–ç•¥$\mu _{\theta _{i}}$ï¼Œå¯ä»¥å¾—åˆ° DDPG çš„æ¢¯åº¦å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
\nabla_{\theta_i} J\left(\mu_i\right)=\mathbb{E}_{\mathbf{x} \sim \mathcal{D}}\left[\left.\nabla_{\theta_i} \mu_i\left(o_i\right) \nabla_{a_i} Q_i^\mu\left(\mathbf{x}, a_1, \ldots, a_N\right)\right|_{a_i=\mu_i\left(o_i\right)}\right]</script><p>å…¶ä¸­ï¼Œ$D$æ˜¯æˆ‘ä»¬ç”¨æ¥å­˜å‚¨æ•°æ®çš„ç»éªŒå›æ”¾æ± ï¼Œå®ƒå­˜å‚¨çš„æ¯ä¸€ä¸ªæ•°æ®ä¸º$\left(\mathbf{x}, \mathbf{x}^{\prime}, a_1, \ldots, a_N, r_1, \ldots, r_N\right)$ã€‚è€Œåœ¨ MADDPG ä¸­ï¼Œä¸­å¿ƒåŒ–åŠ¨ä½œä»·å€¼å‡½æ•°å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æŸå¤±å‡½æ•°æ¥æ›´æ–°ï¼š</p>
<script type="math/tex; mode=display">
\mathcal{L}\left(\omega_i\right)=\mathbb{E}_{\mathbf{x}, a, r, \mathbf{x}^{\prime}}\left[\left(Q_i^\mu\left(\mathbf{x}, a_1, \ldots, a_N\right)-y\right)^2\right], \quad y=r_i+\left.\gamma Q_i^{\mu^{\prime}}\left(\mathbf{x}^{\prime}, a_1^{\prime}, \ldots, a_N^{\prime}\right)\right|_{a_j^{\prime}=\mu_j^{\prime}\left(o_j\right)}</script><p>æµç¨‹ä¸ºï¼š</p>
<p><img src="/2023/03/08/%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E5%AF%B9%E6%8A%97/ä¼ªä»£ç .png" alt="ä¼ªä»£ç "></p>
<h3 id="å…³é”®ä»£ç å®ç°"><a href="#å…³é”®ä»£ç å®ç°" class="headerlink" title="å…³é”®ä»£ç å®ç°"></a>å…³é”®ä»£ç å®ç°</h3><h4 id="è„šæœ¬éƒ¨åˆ†"><a href="#è„šæœ¬éƒ¨åˆ†" class="headerlink" title="è„šæœ¬éƒ¨åˆ†"></a>è„šæœ¬éƒ¨åˆ†</h4><h5 id="æ¢æµ‹å•å…ƒè„šæœ¬"><a href="#æ¢æµ‹å•å…ƒè„šæœ¬" class="headerlink" title="æ¢æµ‹å•å…ƒè„šæœ¬"></a>æ¢æµ‹å•å…ƒè„šæœ¬</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ¢æµ‹å•å…ƒè„šæœ¬</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">script_search</span>(<span class="params">self,agent</span>):</span><br><span class="line">        policy_agents=self.policy_agents        <span class="comment">#ç­–ç•¥æ™ºèƒ½ä½“</span></span><br><span class="line">        scripted_agents = self.scripted_agents  <span class="comment">#è„šæœ¬æ™ºèƒ½ä½“</span></span><br><span class="line">        <span class="comment">#å¯»æ‰¾æœ€è¿‘çš„è¢«æ¢æµ‹å•å…ƒï¼Œåé¢ç”¨</span></span><br><span class="line">        agent_near=self.agent_near(agent)</span><br><span class="line">    <span class="comment">#å½“æ¢æµ‹èŒƒå›´å†…æœ‰è¢«æ¢æµ‹å•å…ƒï¼Œæ¢æµ‹å•å…ƒé™æ­¢ï¼›</span></span><br><span class="line">        <span class="keyword">for</span> agent_i <span class="keyword">in</span> policy_agents:       <span class="comment">#æ¢æµ‹èŒƒå›´å†…æœ‰è¢«æ¢æµ‹å•å…ƒ</span></span><br><span class="line">            dist_agents=self.distance(agent,agent_i)  <span class="comment">#æ¬§å¼è·ç¦»</span></span><br><span class="line">            <span class="keyword">if</span> dist_agents &lt; agent.scope:           <span class="comment">#æ™ºèƒ½ä½“ä¸ç­–ç•¥æ™ºèƒ½ä½“iä¹‹é—´çš„è·ç¦»</span></span><br><span class="line">                agent.state.p_vel =  np.array([<span class="number">0.0</span>,<span class="number">0.0</span>]) <span class="comment">#æ¢æµ‹å•å…ƒé™æ­¢</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#å½“æ¢æµ‹èŒƒå›´å†…æ— è¢«æ¢æµ‹å•å…ƒæ—¶ï¼Œå¦‚å­˜åœ¨æœªè¢«æ¢æµ‹åˆ°æ”»å‡»å·±æ–¹å•å…ƒçš„æ•Œæ–¹æ”»å‡»å•å…ƒï¼Œåˆ™è¶‹å‘æœ€è¿‘çš„è¯¥ç±»å‹å•å…ƒï¼›</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                flag=<span class="literal">False</span></span><br><span class="line">                <span class="keyword">for</span> agent_ii <span class="keyword">in</span> scripted_agents:        </span><br><span class="line">                    <span class="keyword">for</span> agent_iii <span class="keyword">in</span> policy_agents:     </span><br><span class="line">                        <span class="keyword">if</span> agent_iii.category:      <span class="comment">#æ”»å‡»æ™ºèƒ½ä½“</span></span><br><span class="line">                            dist_two_agents=self.distance(agent_ii,agent_iii)</span><br><span class="line">                            <span class="comment">#å·±æ–¹å•å…ƒè¢«æ”»å‡»</span></span><br><span class="line">                            <span class="keyword">if</span> dist_two_agents&lt;agent_iii.scope:  </span><br><span class="line">                                agent.state.p_vel =agent_ii.state.p_pos- agent.state.p_pos  <span class="comment">#è¶‹å‘æœ€è¿‘çš„è¯¥ç±»å‹å•å…ƒ</span></span><br><span class="line">                                speed = np.sqrt(np.square(agent.state.p_vel[<span class="number">0</span>]) + np.square(agent.state.p_vel[<span class="number">1</span>]))<span class="comment">#æ±‚å’Œé€Ÿåº¦</span></span><br><span class="line">                                <span class="keyword">if</span> speed &gt; agent.max_speed:  <span class="comment">#æ›´æ–°é€Ÿåº¦</span></span><br><span class="line">                                        agent.state.p_vel = agent.state.p_vel / np.sqrt(np.square(agent.state.p_vel[<span class="number">0</span>]) +</span><br><span class="line">                                                                                    np.square(agent.state.p_vel[<span class="number">1</span>])) * agent.max_speed</span><br><span class="line">                                flag=<span class="literal">True</span></span><br><span class="line">                                <span class="keyword">break</span></span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                <span class="keyword">continue</span></span><br><span class="line">                    <span class="keyword">if</span> flag:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">    <span class="comment">#å¦åˆ™è¶‹å‘æœ€è¿‘çš„è¢«æ¢æµ‹å•å…ƒã€‚</span></span><br><span class="line">                <span class="keyword">if</span> flag:    <span class="comment">#å·²ç»æ›´æ–°äº†é€Ÿåº¦</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    agent.state.p_vel =agent_near.state.p_pos- agent.state.p_pos      <span class="comment">#è¶‹å‘æœ€è¿‘çš„è¢«æ¢æµ‹å•å…ƒ</span></span><br><span class="line">                    speed = np.sqrt(np.square(agent.state.p_vel[<span class="number">0</span>]) + np.square(agent.state.p_vel[<span class="number">1</span>]))<span class="comment">#æ±‚å’Œé€Ÿåº¦</span></span><br><span class="line">                    <span class="keyword">if</span> speed &gt; agent.max_speed:  <span class="comment">#æ›´æ–°é€Ÿåº¦</span></span><br><span class="line">                            agent.state.p_vel = agent.state.p_vel / np.sqrt(np.square(agent.state.p_vel[<span class="number">0</span>]) +</span><br><span class="line">                                                                        np.square(agent.state.p_vel[<span class="number">1</span>])) * agent.max_speed</span><br><span class="line">        <span class="comment">#ä½ç½®æ›´æ–°</span></span><br><span class="line">        agent.state.p_pos += agent.state.p_vel * self.dt</span><br></pre></td></tr></table></figure>
<h5 id="æ”»å‡»å•å…ƒè„šæœ¬"><a href="#æ”»å‡»å•å…ƒè„šæœ¬" class="headerlink" title="æ”»å‡»å•å…ƒè„šæœ¬"></a>æ”»å‡»å•å…ƒè„šæœ¬</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">##æ”»å‡»å•å…ƒè„šæœ¬</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">script_attack</span>(<span class="params">self,agent</span>):</span><br><span class="line">        policy_agents=self.policy_agents        <span class="comment">#ç­–ç•¥æ™ºèƒ½ä½“</span></span><br><span class="line">        <span class="comment">#å½“æ”»å‡»èŒƒå›´å†…æ— å¤„äºæ¢æµ‹å•å…ƒæ¢æµ‹è§†è§’ä¸‹çš„è¢«æ”»å‡»å•å…ƒï¼Œåˆ™è¶‹å‘æœ€è¿‘çš„è¯¥ç±»å‹å•å…ƒï¼›</span></span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> agent_i <span class="keyword">in</span> policy_agents: </span><br><span class="line">            <span class="comment">#æ”»å‡»èŒƒå›´å†…æœ‰è¢«æ”»å‡»å•å…ƒ</span></span><br><span class="line">            dist_agents=self.distance(agent,agent_i)  <span class="comment">#æ¬§å¼è·ç¦»</span></span><br><span class="line">            <span class="keyword">if</span> dist_agents &lt; agent.scope:           <span class="comment">#æ™ºèƒ½ä½“ä¸ç­–ç•¥æ™ºèƒ½ä½“iä¹‹é—´çš„è·ç¦»</span></span><br><span class="line">                <span class="comment">#æ”»å‡»å•å…ƒé™æ­¢</span></span><br><span class="line">                agent.state_pvel =  np.array([<span class="number">0.0</span>,<span class="number">0.0</span>])</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> flag ==<span class="literal">False</span> :</span><br><span class="line">            agent_near=self.agent_near(agent)</span><br><span class="line">            agent.state.p_vel =agent_near.state.p_pos- agent.state.p_pos      <span class="comment">#è¶‹å‘æœ€è¿‘çš„è¯¥ç±»å‹å•å…ƒ</span></span><br><span class="line">        <span class="comment">#ä½ç½®æ›´æ–°</span></span><br><span class="line">        agent.state.p_pos += agent.state.p_vel * self.dt</span><br></pre></td></tr></table></figure>
<h4 id="å¥–åŠ±å‡½æ•°éƒ¨åˆ†"><a href="#å¥–åŠ±å‡½æ•°éƒ¨åˆ†" class="headerlink" title="å¥–åŠ±å‡½æ•°éƒ¨åˆ†"></a>å¥–åŠ±å‡½æ•°éƒ¨åˆ†</h4><h5 id="æ”»å‡»å•å…ƒå¥–åŠ±"><a href="#æ”»å‡»å•å…ƒå¥–åŠ±" class="headerlink" title="æ”»å‡»å•å…ƒå¥–åŠ±"></a>æ”»å‡»å•å…ƒå¥–åŠ±</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœadvåœ¨agentæ”»å‡»èŒƒå›´å†…</span></span><br><span class="line">            <span class="keyword">for</span> adv <span class="keyword">in</span> adversaries:</span><br><span class="line">                <span class="comment">#è®¡ç®—agentå’Œadvä¹‹é—´çš„è·ç¦»</span></span><br><span class="line">                agent_dist=self.dist(agent,adv)</span><br><span class="line">                <span class="comment">#å¦‚æœåœ¨agentçš„èŒƒå›´å†…</span></span><br><span class="line">                <span class="keyword">if</span> agent_dist &lt;= agent.scope:</span><br><span class="line">                    <span class="comment">#æ”»å‡»æ•Œæ–¹ä¸€æ¬¡</span></span><br><span class="line">                    rew += <span class="number">10</span>       <span class="comment">#å¥–åŠ±</span></span><br><span class="line">                    agent.times_attack += <span class="number">1</span>     <span class="comment">#æ”»å‡»æ¬¡æ•°</span></span><br><span class="line">                    agent.num_scope += <span class="number">1</span>        <span class="comment">#åœ¨æ”»å‡»èŒƒå›´å†…æ™ºèƒ½ä½“çš„æ•°é‡</span></span><br><span class="line">                <span class="keyword">if</span> agent_dist &lt;= adv.scope:</span><br><span class="line">                    <span class="comment">#åˆ¤æ–­ æ•Œæ–¹æ™ºèƒ½ä½“ç±»å‹</span></span><br><span class="line">                    <span class="keyword">if</span> adv.category:</span><br><span class="line">                        <span class="comment">#è¢«æ”»å‡»ä¸€æ¬¡</span></span><br><span class="line">                        rew -= <span class="number">10</span></span><br><span class="line">                        agent.times_attacked +=<span class="number">1</span>        <span class="comment">#è¢«æ”»å‡»æ¬¡æ•°</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="comment">#è¢«æ¢æµ‹ä¸€æ¬¡</span></span><br><span class="line">                        rew-=<span class="number">5</span></span><br><span class="line">                        agent.times_searched += <span class="number">1</span>       <span class="comment">#è¢«æ¢æµ‹æ¬¡æ•°</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<h5 id="æ¢æµ‹å•å…ƒå¥–åŠ±"><a href="#æ¢æµ‹å•å…ƒå¥–åŠ±" class="headerlink" title="æ¢æµ‹å•å…ƒå¥–åŠ±"></a>æ¢æµ‹å•å…ƒå¥–åŠ±</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœadvåœ¨agentæ¢æµ‹èŒƒå›´å†…</span></span><br><span class="line">            <span class="keyword">for</span> adv <span class="keyword">in</span> adversaries:</span><br><span class="line">                <span class="comment">#è®¡ç®—agentå’Œadvä¹‹é—´çš„è·ç¦»</span></span><br><span class="line">                agent_dist=self.dist(agent,adv)</span><br><span class="line">                <span class="comment">#å¦‚æœåœ¨agentçš„èŒƒå›´å†…</span></span><br><span class="line">                <span class="keyword">if</span> agent_dist &lt;= agent.scope:</span><br><span class="line">                    <span class="comment">#æ¢æµ‹æ•Œæ–¹ä¸€æ¬¡</span></span><br><span class="line">                    rew += <span class="number">8</span></span><br><span class="line">                    agent.times_search += <span class="number">1</span>       <span class="comment">#æ¢æµ‹æ¬¡æ•°</span></span><br><span class="line">                    agent.num_scope += <span class="number">1</span>        <span class="comment">#åœ¨æ¢æµ‹èŒƒå›´å†…æ™ºèƒ½ä½“çš„æ•°é‡</span></span><br><span class="line">                <span class="keyword">if</span> agent_dist &lt;= adv.scope:</span><br><span class="line">                    <span class="comment">#åˆ¤æ–­ æ•Œæ–¹æ™ºèƒ½ä½“ç±»å‹</span></span><br><span class="line">                    <span class="keyword">if</span> adv.category:        <span class="comment">#æ”»å‡»å•å…ƒ</span></span><br><span class="line">                        <span class="comment">#è¢«æ”»å‡»ä¸€æ¬¡</span></span><br><span class="line">                        rew -= <span class="number">8</span></span><br><span class="line">                        agent.times_attacked +=<span class="number">1</span>        <span class="comment">#è¢«æ”»å‡»æ¬¡æ•°</span></span><br><span class="line">                    <span class="keyword">else</span>:                   <span class="comment">#æ¢æµ‹å•å…ƒ</span></span><br><span class="line">                        <span class="comment">#è¢«æ¢æµ‹ä¸€æ¬¡</span></span><br><span class="line">                        rew-=<span class="number">4</span></span><br><span class="line">                        agent.times_searched += <span class="number">1</span>       <span class="comment">#è¢«æ¢æµ‹æ¬¡æ•°</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<h5 id="è¾¹ç•Œæƒ©ç½š"><a href="#è¾¹ç•Œæƒ©ç½š" class="headerlink" title="è¾¹ç•Œæƒ©ç½š"></a>è¾¹ç•Œæƒ©ç½š</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bound</span>(<span class="params">x</span>):</span><br><span class="line">            <span class="keyword">if</span> x &lt; <span class="number">0.9</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> x &lt; <span class="number">1.0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">5</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">min</span>(np.exp(<span class="number">2</span> * x - <span class="number">2</span>), <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(world.dim_p):</span><br><span class="line">            x = <span class="built_in">abs</span>(agent.state.p_pos[p])</span><br><span class="line">            rew -= bound(x)</span><br></pre></td></tr></table></figure>
<h4 id="è§‚æµ‹éƒ¨åˆ†"><a href="#è§‚æµ‹éƒ¨åˆ†" class="headerlink" title="è§‚æµ‹éƒ¨åˆ†"></a>è§‚æµ‹éƒ¨åˆ†</h4><p>å•ä¸ªæ™ºèƒ½ä½“èƒ½è§‚æµ‹éƒ½å…¨å±€æ™ºèƒ½ä½“çš„ä¿¡æ¯ï¼Œè¿™ä¸æ˜¯å¾ˆåˆç†ï¼Œä½†æ˜¯é‡‡ç”¨éƒ¨åˆ†è§‚æµ‹ï¼Œæ¯æ¬¡çš„è§‚æµ‹ç»´åº¦ä¸ä¸€æ ·ï¼Œç½‘ç»œç»“æ„æ˜¯æ— æ³•åŠ¨æ€å˜åŒ–çš„ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´å‡ºé”™ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">observation</span>(<span class="params">self, agent, world</span>):</span><br><span class="line">    </span><br><span class="line">    comm = []</span><br><span class="line">    other_pos = []</span><br><span class="line">    other_vel = []</span><br><span class="line">    <span class="keyword">for</span> other <span class="keyword">in</span> world.agents:</span><br><span class="line">        <span class="keyword">if</span> other <span class="keyword">is</span> agent: <span class="keyword">continue</span></span><br><span class="line">        comm.append(other.state.c)</span><br><span class="line">        other_pos.append(other.state.p_pos - agent.state.p_pos)  <span class="comment">#å…¶ä»–æ™ºèƒ½ä½“çš„ä½ç½®</span></span><br><span class="line">        other_vel.append(other.state.p_vel)   <span class="comment">#å…¶ä»–æ™ºèƒ½ä½“çš„é€Ÿåº¦</span></span><br><span class="line">    <span class="keyword">return</span> np.concatenate([agent.state.p_vel] + [agent.state.p_pos]  + other_vel + other_pos)</span><br></pre></td></tr></table></figure>
<h4 id="MADDPGéƒ¨åˆ†"><a href="#MADDPGéƒ¨åˆ†" class="headerlink" title="MADDPGéƒ¨åˆ†"></a>MADDPGéƒ¨åˆ†</h4><h5 id="ç½‘ç»œç»“æ„"><a href="#ç½‘ç»œç»“æ„" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¸‰å±‚çš„å…¨è¿æ¥ç½‘ç»œç»“æ„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TwoLayerFC</span>(torch.nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num_in, num_out, hidden_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.fc1 = torch.nn.Linear(num_in, hidden_dim)          <span class="comment">#çº¿æ€§å˜æ¢</span></span><br><span class="line">        self.fc2 = torch.nn.Linear(hidden_dim, hidden_dim)</span><br><span class="line">        self.fc3 = torch.nn.Linear(hidden_dim, num_out)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = F.relu(self.fc1(x))  <span class="comment">#æ¿€æ´»å‡½æ•°ï¼Œçº¿æ€§å˜æ¢çš„æ‰§è¡Œ</span></span><br><span class="line">        x = F.relu(self.fc2(x))</span><br><span class="line">        <span class="keyword">return</span> self.fc3(x)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="å•æ™ºèƒ½ä½“-DDPG"><a href="#å•æ™ºèƒ½ä½“-DDPG" class="headerlink" title="å•æ™ºèƒ½ä½“ DDPG"></a>å•æ™ºèƒ½ä½“ DDPG</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DDPG</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; DDPGç®—æ³• &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, state_dim, action_dim, critic_input_dim, hidden_dim,</span></span><br><span class="line"><span class="params">                 actor_lr, critic_lr, device</span>):</span><br><span class="line"></span><br><span class="line">        self.actor = TwoLayerFC(state_dim, action_dim, hidden_dim).to(device) 				<span class="comment">#model.to(device)æ•°æ®æŠ•å…¥GPU</span></span><br><span class="line">        self.target_actor = TwoLayerFC(state_dim, action_dim,</span><br><span class="line">                                       hidden_dim).to(device)</span><br><span class="line">        self.critic = TwoLayerFC(critic_input_dim, <span class="number">1</span>, hidden_dim).to(device)</span><br><span class="line">        self.target_critic = TwoLayerFC(critic_input_dim, <span class="number">1</span>,</span><br><span class="line">                                        hidden_dim).to(device)</span><br><span class="line">        self.target_critic.load_state_dict(self.critic.state_dict())</span><br><span class="line">        self.target_actor.load_state_dict(self.actor.state_dict())</span><br><span class="line">        <span class="comment">#ä¸ºéœ€è¦æ›´æ–°çš„actorå’Œcriticåˆ›å»ºä¼˜åŒ–å™¨</span></span><br><span class="line">        self.actor_optimizer = torch.optim.Adam(self.actor.parameters(),</span><br><span class="line">                                                lr=actor_lr)</span><br><span class="line">        self.critic_optimizer = torch.optim.Adam(self.critic.parameters(),</span><br><span class="line">                                                 lr=critic_lr)</span><br><span class="line">    <span class="comment">#é€‰å–åŠ¨ä½œ</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">take_action</span>(<span class="params">self, state, explore=<span class="literal">False</span></span>):</span><br><span class="line">        action = self.actor(state)</span><br><span class="line">        <span class="keyword">if</span> explore:</span><br><span class="line">            action = gumbel_softmax(action)<span class="comment">#ç¦»æ•£ç©ºé—´æ˜ å°„åˆ°è¿ç»­ç©ºé—´ï¼Œèƒ½åå‘ä¼ æ’­</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            action = onehot_from_logits(action)</span><br><span class="line">        <span class="keyword">return</span> action.detach().cpu().numpy()[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#è½¯æ›´æ–°æ¥æ›´æ–°targetç½‘ç»œ</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">soft_update</span>(<span class="params">self, net, target_net, tau</span>):</span><br><span class="line">        <span class="keyword">for</span> param_target, param <span class="keyword">in</span> <span class="built_in">zip</span>(target_net.parameters(),</span><br><span class="line">                                       net.parameters()):</span><br><span class="line">            param_target.data.copy_(param_target.data * (<span class="number">1.0</span> - tau) +</span><br><span class="line">                                    param.data * tau)</span><br></pre></td></tr></table></figure>
<h5 id="MADDPGç±»"><a href="#MADDPGç±»" class="headerlink" title="MADDPGç±»"></a>MADDPGç±»</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MADDPG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, env, device, actor_lr, critic_lr, hidden_dim,</span></span><br><span class="line"><span class="params">                 state_dims, action_dims, critic_input_dim, gamma, tau</span>):</span><br><span class="line">        self.agents = []</span><br><span class="line">        <span class="comment">#æœ‰å¤šä¸ªæ™ºèƒ½ä½“ï¼Œæ¯ä¸ªæ™ºèƒ½ä½“éƒ½æ˜¯ä¸€ä¸ªDDPGå®ä¾‹</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(env.agents)):</span><br><span class="line">            self.agents.append(</span><br><span class="line">                DDPG(state_dims[i],</span><br><span class="line">                 action_dims[i], </span><br><span class="line">                 critic_input_dim,</span><br><span class="line">                hidden_dim, </span><br><span class="line">                actor_lr, </span><br><span class="line">                critic_lr, </span><br><span class="line">                device))</span><br><span class="line">        self.gamma = gamma</span><br><span class="line">        self.tau = tau</span><br><span class="line">        self.critic_criterion = torch.nn.MSELoss()</span><br><span class="line">        self.device = device</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">policies</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> [agt.actor <span class="keyword">for</span> agt <span class="keyword">in</span> self.agents]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">target_policies</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> [agt.target_actor <span class="keyword">for</span> agt <span class="keyword">in</span> self.agents]</span><br><span class="line">    <span class="comment">#åšåŠ¨ä½œ</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">take_action</span>(<span class="params">self, states, explore</span>):</span><br><span class="line">        states = [</span><br><span class="line">            torch.tensor([states[i]], dtype=torch.<span class="built_in">float</span>, device=self.device)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(self.agents))</span><br><span class="line">        ]                               <span class="comment">#å°†çŠ¶æ€é›†åˆä¸­çš„çŠ¶æ€åˆ†ç»™æ¯ä¸ªagent</span></span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            agent.take_action(state, explore)</span><br><span class="line">            <span class="keyword">for</span> agent, state <span class="keyword">in</span> <span class="built_in">zip</span>(self.agents, states)</span><br><span class="line">        ]</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, sample, i_agent</span>):</span><br><span class="line">        obs, act, rew, next_obs, done = sample</span><br><span class="line">        <span class="comment">#ä»replay bufferä¸­é‡‡æ ·ä¸€æ¡transition</span></span><br><span class="line">        cur_agent = self.agents[i_agent]</span><br><span class="line">        <span class="comment">#current_agentå½“å‰éœ€è¦æ›´æ–°çš„ agent</span></span><br><span class="line">        cur_agent.critic_optimizer.zero_grad()</span><br><span class="line">        <span class="comment">#æ¸…ç©ºä¹‹å‰çš„æ¢¯åº¦</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#è®¡ç®—target</span></span><br><span class="line">        all_target_act = [</span><br><span class="line">            onehot_from_logits(pi(_next_obs))</span><br><span class="line">            <span class="keyword">for</span> pi, _next_obs <span class="keyword">in</span> <span class="built_in">zip</span>(self.target_policies, next_obs)</span><br><span class="line">        ]</span><br><span class="line">        <span class="comment">#piæ˜¯ç­–ç•¥ï¼Œ_next_obsæ˜¯ä¸‹ä¸€ä¸ª è§‚æµ‹ï¼Œpi(_next_obs)æ˜¯ä¸‹ä¸€ä¸ªåŠ¨ä½œï¼Œæ±‚å‡ºæ‰€æœ‰åŠ¨ä½œæ”¾åˆ°åˆ—è¡¨</span></span><br><span class="line">        target_critic_input = torch.cat((*next_obs, *all_target_act), dim=<span class="number">1</span>)</span><br><span class="line">        <span class="comment">#å°†çŠ¶æ€så’ŒåŠ¨ä½œaæ‹¼æ¥èµ·æ¥ä½œä¸ºtarget_criticç½‘ç»œçš„è¾“å…¥</span></span><br><span class="line">        <span class="comment">#ä¹Ÿå°±æ˜¯å…¬å¼ä¸­çš„x,a1,a2,â€¦â€¦an</span></span><br><span class="line">        target_critic_value = rew[i_agent].view(</span><br><span class="line">            -<span class="number">1</span>, <span class="number">1</span>) + self.gamma * cur_agent.target_critic(</span><br><span class="line">                target_critic_input) * (<span class="number">1</span> - done[i_agent].view(-<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">        <span class="comment">#1 - done[i_agent]åˆ¤æ–­ç¯å¢ƒæœ‰æ²¡æœ‰ç»ˆæ­¢</span></span><br><span class="line">                <span class="comment">#target_critic_value ç›®æ ‡ç½‘ç»œçš„å€¼ï¼Œå°±æ˜¯y</span></span><br><span class="line">        critic_input = torch.cat((*obs, *act), dim=<span class="number">1</span>)</span><br><span class="line">        <span class="comment">#criticç½‘ç»œè¾“å…¥</span></span><br><span class="line">        critic_value = cur_agent.critic(critic_input)</span><br><span class="line">        <span class="comment">#criticçš„å€¼ï¼Œå°±æ˜¯Q</span></span><br><span class="line">        critic_loss = self.critic_criterion(critic_value,</span><br><span class="line">                                            target_critic_value.detach())</span><br><span class="line">        <span class="comment">#MSE æŸå¤±self.critic_criterion = torch.nn.MSELoss()å‰é¢å®šä¹‰å¥½äº†</span></span><br><span class="line">        critic_loss.backward()<span class="comment">#åå‘ä¼ æ’­</span></span><br><span class="line">        cur_agent.critic_optimizer.step()</span><br><span class="line">        <span class="comment">#æ›´æ–°Actorç½‘ç»œï¼Œç›®æ ‡æ˜¯æœ€å¤§åŒ–Qå€¼ï¼Œç”¨æ¢¯åº¦ä¸Šå‡çš„æ–¹æ³•</span></span><br><span class="line">        cur_agent.actor_optimizer.zero_grad()   <span class="comment">#æ¢¯åº¦æ¸…ç©º</span></span><br><span class="line">        <span class="comment">#è·å–æ‰€æœ‰çš„åŠ¨ä½œ</span></span><br><span class="line">        cur_actor_out = cur_agent.actor(obs[i_agent]) </span><br><span class="line">        cur_act_vf_in = gumbel_softmax(cur_actor_out)</span><br><span class="line">        all_actor_acs = []</span><br><span class="line">        <span class="keyword">for</span> i, (pi, _obs) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(self.policies, obs)):</span><br><span class="line">            <span class="keyword">if</span> i == i_agent:</span><br><span class="line">                all_actor_acs.append(cur_act_vf_in)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                all_actor_acs.append(onehot_from_logits(pi(_obs)))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#æ‹¼æ¥så’Œæ‰€æœ‰çš„a</span></span><br><span class="line">        vf_in = torch.cat((*obs, *all_actor_acs), dim=<span class="number">1</span>)</span><br><span class="line">        <span class="comment">#è®¡ç®—æŸå¤±</span></span><br><span class="line">        actor_loss = -cur_agent.critic(vf_in).mean()</span><br><span class="line">        actor_loss += (cur_actor_out**<span class="number">2</span>).mean() * <span class="number">1e-3</span></span><br><span class="line">        <span class="comment">#åå‘ä¼ æ’­</span></span><br><span class="line">        actor_loss.backward()</span><br><span class="line">        <span class="comment">#ä¼˜åŒ–å™¨æ›´æ–°å‚æ•°</span></span><br><span class="line">        cur_agent.actor_optimizer.step()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ›´æ–°targetç½‘ç»œ</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_all_targets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> agt <span class="keyword">in</span> self.agents:</span><br><span class="line">            agt.soft_update(agt.actor, agt.target_actor, self.tau)</span><br><span class="line">            agt.soft_update(agt.critic, agt.target_critic, self.tau)</span><br></pre></td></tr></table></figure>
<h5 id="å‚æ•°è®¾ç½®"><a href="#å‚æ•°è®¾ç½®" class="headerlink" title="å‚æ•°è®¾ç½®"></a>å‚æ•°è®¾ç½®</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">num_episodes = <span class="number">8000</span> <span class="comment">#è®­ç»ƒæ¬¡æ•°ï¼Œ5000ä¸ªå›åˆ</span></span><br><span class="line">episode_length = <span class="number">25</span>  <span class="comment"># æ¯æ¡åºåˆ—çš„æœ€å¤§é•¿åº¦ï¼Œæ¯ä¸ªå›åˆçš„é•¿åº¦</span></span><br><span class="line">buffer_size = <span class="number">100000</span> <span class="comment">#reply buffferå¤§å°</span></span><br><span class="line">hidden_dim = <span class="number">64</span> <span class="comment">#éšè—å±‚ç¥ç»å…ƒæ•°é‡</span></span><br><span class="line">actor_lr = <span class="number">1e-2</span> <span class="comment">#å­¦ä¹ ç‡</span></span><br><span class="line">critic_lr = <span class="number">1e-2</span> <span class="comment">#å­¦ä¹ ç‡</span></span><br><span class="line">gamma = <span class="number">0.95</span> <span class="comment">#è¡°å‡</span></span><br><span class="line">tau = <span class="number">1e-2</span> <span class="comment">#ç›®æ ‡ç½‘ç»œæ›´æ–°ç³»æ•°ç³»æ•°</span></span><br><span class="line">batch_size = <span class="number">1024</span> <span class="comment">#é‡‡æ ·æ•°é‡</span></span><br><span class="line">device = torch.device(<span class="string">&quot;cuda:0&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">update_interval = <span class="number">100</span> <span class="comment">#é‡‡é›†å¤šå°‘ä¸ªtransitionè¿›è¡Œä¸€æ¬¡æ›´æ–°</span></span><br><span class="line">minimal_size = <span class="number">4000</span> <span class="comment">#reply bufferæ²¡æœ‰è¾¾åˆ°minimal_sizeä¸å»è®­ç»ƒ</span></span><br><span class="line"></span><br><span class="line">env_id = <span class="string">&quot;simple_myenv&quot;</span> <span class="comment">#ç¯å¢ƒ simple_adversary</span></span><br><span class="line">env = make_env(env_id) <span class="comment">#åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">replay_buffer = rl_utils.ReplayBuffer(buffer_size)</span><br><span class="line"></span><br><span class="line">state_dims = []<span class="comment">#çŠ¶æ€ç©ºé—´ç»´åº¦åˆ—è¡¨</span></span><br><span class="line">action_dims = []<span class="comment">#åŠ¨ä½œç©ºé—´ç»´åº¦åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">for</span> action_space <span class="keyword">in</span> env.action_space:</span><br><span class="line">    action_dims.append(action_space.n)</span><br><span class="line">    <span class="comment">#print(action_space.n)</span></span><br><span class="line"><span class="keyword">for</span> state_space <span class="keyword">in</span> env.observation_space:</span><br><span class="line">    state_dims.append(state_space.shape[<span class="number">0</span>])</span><br><span class="line">    <span class="comment">#print(state_space.shape[0])#</span></span><br><span class="line">critic_input_dim = <span class="built_in">sum</span>(state_dims) + <span class="built_in">sum</span>(action_dims)</span><br><span class="line"><span class="comment">#criticç½‘ç»œè¾“å…¥ç»´åº¦=çŠ¶æ€ç»´åº¦+åŠ¨ä½œç»´åº¦</span></span><br><span class="line">maddpg = MADDPG(env, device, actor_lr, critic_lr, hidden_dim, state_dims,</span><br><span class="line">                action_dims, critic_input_dim, gamma, tau)</span><br></pre></td></tr></table></figure>
<h5 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">return_list = []  <span class="comment"># è®°å½•æ¯ä¸€è½®çš„ç´¯è®¡å¥–åŠ±ï¼ˆreturnï¼‰</span></span><br><span class="line">total_step = <span class="number">0</span></span><br><span class="line">attack_n = []		<span class="comment">#è®°å½•æ”»å‡»æ¬¡æ•°</span></span><br><span class="line">attacked_n = []		<span class="comment">#è®°å½•è¢«æ”»å‡»æ¬¡æ•°</span></span><br><span class="line">search_n = []		<span class="comment">#è®°å½•æ¢æµ‹æ¬¡æ•°</span></span><br><span class="line">searched_n = []		<span class="comment">#è®°å½•è¢«æ¢æµ‹æ¬¡æ•°</span></span><br><span class="line"><span class="comment">#ä¸»ä½“éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">for</span> i_episode <span class="keyword">in</span> <span class="built_in">range</span>(num_episodes):</span><br><span class="line">    <span class="comment">#å›åˆå¾ªç¯</span></span><br><span class="line">    state = env.reset()</span><br><span class="line">    <span class="comment">#é‡æ–°åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">for</span> agent_i <span class="keyword">in</span> env.agents:</span><br><span class="line">        agent_i.times_attack = <span class="number">0</span></span><br><span class="line">        agent_i.times_attacked = <span class="number">0</span></span><br><span class="line">        agent_i.times_search = <span class="number">0</span></span><br><span class="line">        agent_i.times_searched = <span class="number">0</span></span><br><span class="line">    returns = np.zeros(<span class="built_in">len</span>(env.agents))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> e_i <span class="keyword">in</span> <span class="built_in">range</span>(episode_length):           <span class="comment">#æ¯ä¸ªå›åˆ25æ­¥</span></span><br><span class="line">        actions = maddpg.take_action(state, explore=<span class="literal">True</span>)       <span class="comment">#æ ¹æ®çŠ¶æ€é€‰å–åŠ¨ä½œ</span></span><br><span class="line">        next_state, reward, done, info= env.step(actions)</span><br><span class="line">        reward = np.array(reward)</span><br><span class="line">        returns += reward</span><br><span class="line">        replay_buffer.add(state, actions, reward, next_state, done)</span><br><span class="line">        <span class="comment">#æ”¾å…¥replay buffer</span></span><br><span class="line">        state = next_state</span><br><span class="line">        <span class="comment">#æ›´æ–°çŠ¶æ€</span></span><br><span class="line">        total_step += <span class="number">1</span></span><br><span class="line">        env.render()</span><br><span class="line">        <span class="keyword">if</span> replay_buffer.size(</span><br><span class="line">        ) &gt;= minimal_size <span class="keyword">and</span> total_step % update_interval == <span class="number">0</span>:</span><br><span class="line">            <span class="comment">#replay bufferä¸­å¤Ÿ4000äº†å°±å¼€å§‹é‡‡æ ·ï¼Œæ³¨æ„è¿™é‡Œç”¨çš„æ˜¯rl_utilsä¸­çš„sampleå‡½æ•°ï¼Œéšæœºé‡‡æ ·</span></span><br><span class="line">            sample = replay_buffer.sample(batch_size)</span><br><span class="line">            <span class="comment">#æ•°æ®é‡æ•´ï¼Œå°†aæ”¾åˆ°ä¸€èµ·ï¼Œsæ”¾åˆ°ä¸€èµ·</span></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">stack_array</span>(<span class="params">x</span>):</span><br><span class="line">                rearranged = [[sub_x[i] <span class="keyword">for</span> sub_x <span class="keyword">in</span> x]</span><br><span class="line">                              <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x[<span class="number">0</span>]))]</span><br><span class="line">                <span class="keyword">return</span> [</span><br><span class="line">                    torch.FloatTensor(np.vstack(aa)).to(device)</span><br><span class="line">                    <span class="keyword">for</span> aa <span class="keyword">in</span> rearranged</span><br><span class="line">                ]</span><br><span class="line">            <span class="comment">#å¤„ç†æ ·æœ¬sampleï¼Œæ›´æ–°ç½‘ç»œ00.</span></span><br><span class="line">            sample = [stack_array(x) <span class="keyword">for</span> x <span class="keyword">in</span> sample]</span><br><span class="line">            <span class="keyword">for</span> a_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(env.agents)):</span><br><span class="line">                maddpg.update(sample, a_i)</span><br><span class="line">            maddpg.update_all_targets()</span><br><span class="line">    <span class="comment">#è®°å½•æ¯ä¸€è½®å›æŠ¥</span></span><br><span class="line">    return_list.append(returns)</span><br><span class="line">    <span class="comment">#è®°å½•æ”»å‡»/æ¢æµ‹æ¬¡æ•°</span></span><br><span class="line">    times_attack_n = []</span><br><span class="line">    times_attacked_n = []</span><br><span class="line">    times_search_n = []</span><br><span class="line">    times_searched_n = []</span><br><span class="line">    <span class="keyword">for</span> i,agent_i <span class="keyword">in</span> <span class="built_in">enumerate</span>(env.agents):</span><br><span class="line">        <span class="keyword">if</span> i &lt;<span class="number">5</span>:</span><br><span class="line">            <span class="keyword">if</span> agent_i.category:</span><br><span class="line">                times_attack_n.append(agent_i.times_attack)<span class="comment">#æ”»å‡»æ¬¡æ•°</span></span><br><span class="line">                times_attacked_n.append(agent_i.times_attacked)<span class="comment">#è¢«æ”»å‡»æ¬¡æ•°</span></span><br><span class="line">                times_searched_n.append(agent_i.times_searched)<span class="comment">#è¢«æ¢æµ‹æ¬¡æ•°</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                times_search_n.append(agent_i.times_search)<span class="comment">#æ¢æµ‹æ¬¡æ•°</span></span><br><span class="line">                times_attacked_n.append(agent_i.times_attacked)<span class="comment">#è¢«æ”»å‡»æ¬¡æ•°</span></span><br><span class="line">                times_searched_n.append(agent_i.times_searched)<span class="comment">#è¢«æ¢æµ‹æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    attack_n .append(times_attack_n)</span><br><span class="line">    attacked_n .append(times_attacked_n)</span><br><span class="line">    search_n .append(times_search_n)</span><br><span class="line">    searched_n .append(times_searched_n )</span><br><span class="line">    <span class="keyword">if</span> replay_buffer.size()%<span class="number">100</span>==<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;transitionsçš„æ•°ç›®&#123;&#125;&quot;</span>.<span class="built_in">format</span>(replay_buffer.size()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç¬¬&#123;&#125;ä¸ªepisodeç»“æŸ,å›æŠ¥ä¸º&#123;&#125;,&#x27;</span>.<span class="built_in">format</span>(i_episode,returns))</span><br><span class="line">        </span><br></pre></td></tr></table></figure>
<h5 id="å­˜å‚¨æ•°æ®"><a href="#å­˜å‚¨æ•°æ®" class="headerlink" title="å­˜å‚¨æ•°æ®"></a>å­˜å‚¨æ•°æ®</h5><p>å­˜å‚¨ æ¯ä¸€è½®çš„å›æŠ¥ï¼Œæ”»å‡»æ¬¡æ•°ï¼Œæ¢æµ‹æ¬¡æ•°ï¼Œè¢«æ”»å‡»æ¬¡æ•°ï¼Œè¢«æ¢æµ‹æ¬¡æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line">return_array = np.array(return_list)</span><br><span class="line">return_data = pd.DataFrame(return_array)</span><br><span class="line"></span><br><span class="line">writer = pd.ExcelWriter(<span class="string">&#x27;return_array.xlsx&#x27;</span>)		<span class="comment"># å†™å…¥Excelæ–‡ä»¶</span></span><br><span class="line">return_data.to_excel(writer, <span class="string">&#x27;page_1&#x27;</span>, float_format=<span class="string">&#x27;%.5f&#x27;</span>)		<span class="comment"># â€˜page_1â€™æ˜¯å†™å…¥excelçš„sheetå</span></span><br><span class="line">writer.save()</span><br><span class="line">writer.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">attack_array = np.array(attack_n)</span><br><span class="line">attack_data = pd.DataFrame(attack_array)</span><br><span class="line"></span><br><span class="line">writer = pd.ExcelWriter(<span class="string">&#x27;attack.xlsx&#x27;</span>)		<span class="comment"># å†™å…¥Excelæ–‡ä»¶</span></span><br><span class="line">attack_data.to_excel(writer, <span class="string">&#x27;page_1&#x27;</span>, float_format=<span class="string">&#x27;%.5f&#x27;</span>)		</span><br><span class="line">writer.save()</span><br><span class="line">writer.close()</span><br><span class="line"></span><br><span class="line">search_array = np.array(search_n)</span><br><span class="line">search_data = pd.DataFrame(search_array)</span><br><span class="line"></span><br><span class="line">writer = pd.ExcelWriter(<span class="string">&#x27;search.xlsx&#x27;</span>)		<span class="comment"># å†™å…¥Excelæ–‡ä»¶</span></span><br><span class="line">search_data.to_excel(writer, <span class="string">&#x27;page_1&#x27;</span>, float_format=<span class="string">&#x27;%.5f&#x27;</span>)		</span><br><span class="line">writer.save()</span><br><span class="line">writer.close()</span><br><span class="line"></span><br><span class="line">attacked_array = np.array(attacked_n)</span><br><span class="line">attacked_data = pd.DataFrame(attacked_array)</span><br><span class="line"></span><br><span class="line">writer = pd.ExcelWriter(<span class="string">&#x27;attacked.xlsx&#x27;</span>)		<span class="comment"># å†™å…¥Excelæ–‡ä»¶</span></span><br><span class="line">attacked_data.to_excel(writer, <span class="string">&#x27;page_1&#x27;</span>, float_format=<span class="string">&#x27;%.5f&#x27;</span>)		</span><br><span class="line">writer.save()</span><br><span class="line">writer.close()</span><br><span class="line"></span><br><span class="line">searched_array = np.array(searched_n)</span><br><span class="line">searched_data = pd.DataFrame(searched_array)</span><br><span class="line"></span><br><span class="line">writer = pd.ExcelWriter(<span class="string">&#x27;searched.xlsx&#x27;</span>)		<span class="comment"># å†™å…¥Excelæ–‡ä»¶</span></span><br><span class="line">searched_data.to_excel(writer, <span class="string">&#x27;page_1&#x27;</span>, float_format=<span class="string">&#x27;%.5f&#x27;</span>)		<span class="comment"># â€˜page_1â€™æ˜¯å†™å…¥excelçš„sheetå</span></span><br><span class="line">writer.save()</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure>
<h5 id="ç»˜å›¾"><a href="#ç»˜å›¾" class="headerlink" title="ç»˜å›¾"></a>ç»˜å›¾</h5><h6 id="ç»˜åˆ¶å›æŠ¥æ›²çº¿"><a href="#ç»˜åˆ¶å›æŠ¥æ›²çº¿" class="headerlink" title="ç»˜åˆ¶å›æŠ¥æ›²çº¿"></a>ç»˜åˆ¶å›æŠ¥æ›²çº¿</h6><h6 id="ç»˜åˆ¶æ”»å‡»æ•°æ®æ›²çº¿"><a href="#ç»˜åˆ¶æ”»å‡»æ•°æ®æ›²çº¿" class="headerlink" title="ç»˜åˆ¶æ”»å‡»æ•°æ®æ›²çº¿"></a>ç»˜åˆ¶æ”»å‡»æ•°æ®æ›²çº¿</h6><h6 id="ç»˜åˆ¶èƒœè´Ÿå¹³ç‡"><a href="#ç»˜åˆ¶èƒœè´Ÿå¹³ç‡" class="headerlink" title="ç»˜åˆ¶èƒœè´Ÿå¹³ç‡"></a>ç»˜åˆ¶èƒœè´Ÿå¹³ç‡</h6><h4 id="æ²¡æœ‰å®ç°çš„éƒ¨åˆ†"><a href="#æ²¡æœ‰å®ç°çš„éƒ¨åˆ†" class="headerlink" title="æ²¡æœ‰å®ç°çš„éƒ¨åˆ†"></a>æ²¡æœ‰å®ç°çš„éƒ¨åˆ†</h4><p>åœ¨å¥–åŠ±ä¸­ï¼Œæ¯ä¸€ä¸ªå›åˆç»“æŸä¹‹åçš„å¥–åŠ±æ²¡æœ‰å®ç°ï¼Œå› ä¸ºä¹‹å‰çš„å¥–åŠ±éƒ½æ˜¯ç»™åŠ¨ä½œçš„ï¼Œreply_bufferä¸­å­˜å‚¨çš„éƒ½æ˜¯äº”å…ƒç»„ï¼Œå›åˆä¹‹åçš„å¥–åŠ±ä¸æ¸…æ¥šåº”è¯¥ç»™ä»€ä¹ˆã€‚</p>
<h2 id="å¯¹æ¯”å®éªŒè®¾è®¡"><a href="#å¯¹æ¯”å®éªŒè®¾è®¡" class="headerlink" title="å¯¹æ¯”å®éªŒè®¾è®¡"></a>å¯¹æ¯”å®éªŒè®¾è®¡</h2><ol>
<li>MADDPG</li>
<li>PER+MADDPG</li>
</ol>
<h3 id="PERåŸç†"><a href="#PERåŸç†" class="headerlink" title="PERåŸç†"></a>PERåŸç†</h3><p>å¸¦æœ‰ä¼˜å…ˆçº§é‡‡æ ·æ–¹æ³•ä¼šæ ¹æ®æ¨¡å‹å¯¹å½“å‰æ ·æœ¬çš„è¡¨ç°æƒ…å†µï¼Œç»™äºˆæ ·æœ¬ä¸åŒçš„é‡‡æ ·æƒé‡ï¼Œæ‰“ç ´äº†ä¼ ç»Ÿçš„å‡åŒ€é‡‡æ ·æ–¹æ³•ï¼Œæé«˜äº†æ ·æœ¬çš„åˆ©ç”¨ç‡å’Œå­¦ä¹ æ•ˆç‡ã€‚ç›¸æ¯”è€Œè¨€ï¼Œå¸¦ä¼˜å…ˆçº§çš„ç»éªŒé‡æ”¾ä¸»è¦é¢å¤–å¢åŠ äº†ä»¥ä¸‹ä¸¤æ­¥ï¼š</p>
<ol>
<li>æ ·æœ¬ä¼˜å…ˆçº§çš„è®¾ç½®ï¼›</li>
<li>åŸºäºä¼˜å…ˆçº§çš„é‡‡æ ·ã€‚</li>
</ol>
<p>æ ·æœ¬ä¼˜å…ˆçº§å¯ä»¥é‡‡ç”¨å¼ºåŒ–å­¦ä¹ ä¸­ TD åå·®æ¥è¡¡é‡ï¼š</p>
<script type="math/tex; mode=display">
T D-e r r o r=R(s, a)+\gamma Q(s, a)-Q(s, a)</script><p>TD åå·®è¶Šå¤§ï¼Œè¯´æ˜æ™ºèƒ½ä½“åœ¨è¯¥çŠ¶æ€å¤„çš„å‚æ•°æ›´æ–°é‡è¶Šå¤§ï¼Œè¯¥æ ·æœ¬çš„å­¦ä¹ ä»·å€¼è¶Šé«˜ã€‚è®¾ç»éªŒæ ·æœ¬ i å¯¹åº”çš„TD åå·®ä¸º $Î´i $ï¼Œå¯¹è¯¥ç»éªŒæ ·æœ¬çš„é‡‡æ ·æ¦‚ç‡ä¸ºï¼š</p>
<script type="math/tex; mode=display">
P(i)=\frac{p_i^\alpha}{\sum_k p_k^\alpha}</script><p>å…¶ä¸­ï¼Œ$p_i$ä¸ºæ¯ä¸ªæ ·æœ¬çš„æƒå€¼ï¼Œå³ TD åå·®çš„ç»å¯¹å€¼ï¼ˆ|Î´i|ï¼‰ï¼ŒæŒ‡æ•° Î± å†³å®šäº†ä½¿ç”¨å¸¦ä¼˜å…ˆçº§é‡‡æ ·çš„ç¨‹åº¦ï¼Œå½“ Î±ç­‰äº 0 æ—¶ä¸ºå‡åŒ€é‡‡æ ·ã€‚å¯¹äºåŸºäºä¼˜å…ˆçº§çš„é‡‡æ ·æ–¹æ³•å’Œç»éªŒé‡æ”¾ç¼“å­˜æ ·æœ¬ä¼˜å…ˆçº§çš„ç»´æŠ¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç§å®Œå…¨äºŒå‰æ ‘ç»“æ„ SumTree æ¥å®ç°ï¼Œå…¶ä¸­å¶å­èŠ‚ç‚¹é¡ºåºå­˜æ”¾æ¯ä¸ªæ ·æœ¬çš„ä¼˜å…ˆçº§ P(i) ã€‚åœ¨é‡‡æ ·æ—¶ï¼Œä¾æ®æ ¹èŠ‚ç‚¹çš„ä¼˜<br>å…ˆçº§æ€»å’Œï¼Œå‡åˆ†ä¸º $n =âˆ‘P(i)/BATCH_SIZE$ ä¸ªåŒºé—´ï¼Œåœ¨<br>æ¯ä¸ªåŒºé—´å†…éšæœºå–ä¸€ä¸ªæ•°å€¼ï¼ŒæŒ‰ç…§äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼æ‰¾åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ã€‚</p>
<p>åŸç†å›¾ï¼š</p>
<p><img src="/2023/03/08/%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E5%AF%B9%E6%8A%97/PERåŸç†.png" alt="PERåŸç†"></p>
<p>å…·ä½“è®­ç»ƒæµç¨‹:</p>
<p><img src="/2023/03/08/%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E5%AF%B9%E6%8A%97/æµç¨‹.png" alt="æµç¨‹"></p>
<h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple, deque</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrioritizedReplay</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Fixed-size buffer to store prioritized experience tuples.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,batch_size, capacity,seed, alpha</span>):</span><br><span class="line">        self.buffer = deque(maxlen=capacity)</span><br><span class="line">        self.priorities = deque(maxlen=capacity)</span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line">        self.seed = random.seed(seed)</span><br><span class="line">        self.alpha = alpha</span><br><span class="line">        self.epsilon = <span class="number">1e-5</span> </span><br><span class="line">          </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, state, action, reward, next_state, done, priority</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Add a new experience to memory.&quot;&quot;&quot;</span></span><br><span class="line">        self.buffer.append((state, action, reward, next_state, done)) </span><br><span class="line">        self.priorities.append(priority)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sample</span>(<span class="params">self, beta</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Randomly sample a batch of experiences from memory.&quot;&quot;&quot;</span></span><br><span class="line">        priorities = np.array(self.priorities).reshape(-<span class="number">1</span>)</span><br><span class="line">        priorities = np.power(priorities + self.epsilon, self.alpha)  <span class="comment"># add a small value epsilon to ensure numeric stability</span></span><br><span class="line">        p = priorities/np.<span class="built_in">sum</span>(priorities)  <span class="comment"># compute a probability density over the priorities</span></span><br><span class="line">        sampled_indices = np.random.choice(np.arange(<span class="built_in">len</span>(p)), size=self.batch_size, p=p)  <span class="comment"># choose random indices given p</span></span><br><span class="line">        transitions = [self.buffer[i] <span class="keyword">for</span> i <span class="keyword">in</span> sampled_indices]     <span class="comment"># subset the experiences</span></span><br><span class="line">        p = np.array([p[i] <span class="keyword">for</span> i <span class="keyword">in</span> sampled_indices]).reshape(-<span class="number">1</span>)</span><br><span class="line">        state, action, reward, next_state, done = <span class="built_in">zip</span>(*transitions)</span><br><span class="line">        weights = np.power(<span class="built_in">len</span>(transitions) * p, -beta)</span><br><span class="line">        weights /= weights.<span class="built_in">max</span>()</span><br><span class="line">        weights = torch.from_numpy(weights).<span class="built_in">float</span>().to(device)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> np.array(state), action, reward, np.array(next_state), done </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, indices, priorities</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Update the priority values after training given the samples drawn.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i, priority <span class="keyword">in</span> <span class="built_in">zip</span>(indices, priorities):</span><br><span class="line">            self.priorities[i] = priority</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">size</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.buffer)</span><br><span class="line">    </span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h2 id="æœªå®ç°çš„éƒ¨åˆ†"><a href="#æœªå®ç°çš„éƒ¨åˆ†" class="headerlink" title="æœªå®ç°çš„éƒ¨åˆ†"></a>æœªå®ç°çš„éƒ¨åˆ†</h2><h3 id="å¥–åŠ±å‡½æ•°éƒ¨åˆ†-1"><a href="#å¥–åŠ±å‡½æ•°éƒ¨åˆ†-1" class="headerlink" title="å¥–åŠ±å‡½æ•°éƒ¨åˆ†"></a>å¥–åŠ±å‡½æ•°éƒ¨åˆ†</h3><p>åœ¨å¥–åŠ±ä¸­ï¼Œæ¯ä¸€ä¸ªå›åˆç»“æŸä¹‹åçš„å¥–åŠ±æ²¡æœ‰å®ç°ï¼Œå› ä¸ºä¹‹å‰çš„å¥–åŠ±éƒ½æ˜¯ç»™åŠ¨ä½œçš„ï¼Œreply_bufferä¸­å­˜å‚¨çš„éƒ½æ˜¯äº”å…ƒç»„ï¼Œå›åˆä¹‹åçš„å¥–åŠ±ä¸æ¸…æ¥šåº”è¯¥ç»™ä»€ä¹ˆã€‚</p>
<h3 id="PERéƒ¨åˆ†"><a href="#PERéƒ¨åˆ†" class="headerlink" title="PERéƒ¨åˆ†"></a>PERéƒ¨åˆ†</h3><p>æ²¡æœ‰å®ç°ä¼˜å…ˆæƒé‡çš„æ›´æ–°ï¼ŒPERè¿˜æ²¡æœ‰å®Œå…¨èå…¥MADDPGä¸­ã€‚</p>
]]></content>
      <categories>
        <category>æ¯•è®¾</category>
      </categories>
      <tags>
        <tag>æ¯•è®¾</tag>
      </tags>
  </entry>
</search>
